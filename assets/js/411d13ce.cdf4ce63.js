"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[5012],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>k});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var p=a.createContext({}),c=function(e){var t=a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},u=function(e){var t=c(e.components);return a.createElement(p.Provider,{value:t},e.children)},s="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,p=e.parentName,u=o(e,["components","mdxType","originalType","parentName"]),s=c(n),m=r,k=s["".concat(p,".").concat(m)]||s[m]||d[m]||i;return n?a.createElement(k,l(l({ref:t},u),{},{components:n})):a.createElement(k,l({ref:t},u))}));function k(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,l=new Array(i);l[0]=m;var o={};for(var p in t)hasOwnProperty.call(t,p)&&(o[p]=t[p]);o.originalType=e,o[s]="string"==typeof e?e:r,l[1]=o;for(var c=2;c<i;c++)l[c]=n[c];return a.createElement.apply(null,l)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},9583:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>l,default:()=>s,frontMatter:()=>i,metadata:()=>o,toc:()=>c});var a=n(7462),r=(n(7294),n(3905));const i={},l="18 \u3010Redux Toolkit\u3011",o={unversionedId:"React/18 \u3010Redux Toolkit\u3011",id:"React/18 \u3010Redux Toolkit\u3011",title:"18 \u3010Redux Toolkit\u3011",description:"\u4e0a\u8fb9\u7684\u6848\u4f8b\u6211\u4eec\u4e00\u76f4\u5728\u4f7f\u7528Redux\u6838\u5fc3\u5e93\u6765\u4f7f\u7528Redux\uff0c\u9664\u4e86Redux\u6838\u5fc3\u5e93\u5916Redux\u8fd8\u4e3a\u6211\u4eec\u63d0\u4f9b\u4e86\u4e00\u79cd\u4f7f\u7528Redux\u7684\u65b9\u5f0f\u2014\u2014Redux Toolkit\u3002\u5b83\u7684\u540d\u5b57\u8d77\u7684\u975e\u5e38\u76f4\u767d\uff0cRedux\u5de5\u5177\u5305\uff0c\u7b80\u79f0RTK\u3002RTK\u53ef\u4ee5\u5e2e\u52a9\u6211\u4eec\u5904\u7406\u4f7f\u7528Redux\u8fc7\u7a0b\u4e2d\u7684\u91cd\u590d\u6027\u5de5\u4f5c\uff0c\u7b80\u5316Redux\u4e2d\u7684\u5404\u79cd\u64cd\u4f5c\u3002",source:"@site/docs/React/18 \u3010Redux Toolkit\u3011.md",sourceDirName:"React",slug:"/React/18 \u3010Redux Toolkit\u3011",permalink:"/docs/React/18 \u3010Redux Toolkit\u3011",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/React/18 \u3010Redux Toolkit\u3011.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"17 \u3010redux\u3011",permalink:"/docs/React/17\u3010redux\u3011"},next:{title:"19 \u3010RTK Query\u3011",permalink:"/docs/React/19 \u3010RTK Query\u3011"}},p={},c=[{value:"1.Redux Toolkit \u6982\u89c8",id:"1redux-toolkit-\u6982\u89c8",level:2},{value:"1.1  Redux Toolkit \u662f\u4ec0\u4e48\uff1f",id:"11--redux-toolkit-\u662f\u4ec0\u4e48",level:3},{value:"1.2 \u76ee\u7684",id:"12-\u76ee\u7684",level:3},{value:"1.3 \u4e3a\u4ec0\u4e48\u9700\u8981\u4f7f\u7528 Redux Toolkit",id:"13-\u4e3a\u4ec0\u4e48\u9700\u8981\u4f7f\u7528-redux-toolkit",level:3},{value:"1.4 \u6587\u6863\u94fe\u63a5",id:"14-\u6587\u6863\u94fe\u63a5",level:3},{value:"2.\u5b89\u88c5",id:"2\u5b89\u88c5",level:2},{value:"3.\u57fa\u7840\u5f00\u53d1\u6d41\u7a0b",id:"3\u57fa\u7840\u5f00\u53d1\u6d41\u7a0b",level:2},{value:"3.1 \u521b\u5efa Redux State Slice",id:"31-\u521b\u5efa-redux-state-slice",level:3},{value:"3.2 \u5c06 Slice Reducers \u6dfb\u52a0\u5230 Store \u4e2d",id:"32-\u5c06-slice-reducers-\u6dfb\u52a0\u5230-store-\u4e2d",level:3},{value:"3.3 store\u52a0\u5230\u5168\u5c40",id:"33-store\u52a0\u5230\u5168\u5c40",level:3},{value:"3.4 \u5728 React \u7ec4\u4ef6\u4e2d\u4f7f\u7528 Redux \u72b6\u6001\u548c\u64cd\u4f5c",id:"34-\u5728-react-\u7ec4\u4ef6\u4e2d\u4f7f\u7528-redux-\u72b6\u6001\u548c\u64cd\u4f5c",level:3},{value:"3.5 \u5c0f\u603b\u7ed3",id:"35-\u5c0f\u603b\u7ed3",level:3},{value:"4.\u8865\u5145\u89e3\u6790\u4e0a\u9762\u8ba1\u6570\u5668\u6848\u4f8b",id:"4\u8865\u5145\u89e3\u6790\u4e0a\u9762\u8ba1\u6570\u5668\u6848\u4f8b",level:2},{value:"4.1 \u521b\u5efa Slice Reducer \u548c Action",id:"41-\u521b\u5efa-slice-reducer-\u548c-action",level:3},{value:"4.2 Reducer \u7684\u89c4\u5219",id:"42-reducer-\u7684\u89c4\u5219",level:3},{value:"4.3 Reducer \u4e0e Immutable \u66f4\u65b0",id:"43-reducer-\u4e0e-immutable-\u66f4\u65b0",level:3},{value:"5.\u4f20\u9012\u53c2\u6570",id:"5\u4f20\u9012\u53c2\u6570",level:2},{value:"5.1 \u5b9a\u4e49\u63a5\u53d7\u53c2\u6570",id:"51-\u5b9a\u4e49\u63a5\u53d7\u53c2\u6570",level:3},{value:"5.2 \u4f20\u9012\u53c2\u6570",id:"52-\u4f20\u9012\u53c2\u6570",level:3},{value:"5.3 Action Payloads",id:"53-action-payloads",level:3},{value:"6.\u5f02\u6b65\u903b\u8f91\u4e0e\u6570\u636e\u8bf7\u6c42",id:"6\u5f02\u6b65\u903b\u8f91\u4e0e\u6570\u636e\u8bf7\u6c42",level:2},{value:"6.1 Thunks \u4e0e\u5f02\u6b65\u903b\u8f91",id:"61-thunks-\u4e0e\u5f02\u6b65\u903b\u8f91",level:3},{value:"6.2 Thunk \u51fd\u6570",id:"62-thunk-\u51fd\u6570",level:3},{value:"6.3 \u6539\u5199\u4e4b\u524d\u7684\u8ba1\u6570\u5668\u6848\u4f8b",id:"63-\u6539\u5199\u4e4b\u524d\u7684\u8ba1\u6570\u5668\u6848\u4f8b",level:3},{value:"6.4 \u7f16\u5199\u5f02\u6b65 Thunks",id:"64-\u7f16\u5199\u5f02\u6b65-thunks",level:3},{value:"6.5 \u4f7f\u7528 createAsyncThunk \u8bf7\u6c42\u6570\u636e",id:"65-\u4f7f\u7528-createasyncthunk-\u8bf7\u6c42\u6570\u636e",level:3},{value:"6.6 \u4f7f\u7528 extraReducers",id:"66-\u4f7f\u7528-extrareducers",level:3},{value:"6.7 \u5b8c\u5584\u6848\u4f8b",id:"67-\u5b8c\u5584\u6848\u4f8b",level:3},{value:"7.\u6570\u636e\u6301\u4e45\u5316",id:"7\u6570\u636e\u6301\u4e45\u5316",level:2},{value:"7.1 \u6982\u5ff5",id:"71-\u6982\u5ff5",level:3},{value:"7.2 \u4f7f\u7528",id:"72-\u4f7f\u7528",level:3},{value:"7.3 \u8ba9\u6bcf\u4e00\u4e2a\u4ed3\u5e93\u5355\u72ec\u5b58\u50a8",id:"73-\u8ba9\u6bcf\u4e00\u4e2a\u4ed3\u5e93\u5355\u72ec\u5b58\u50a8",level:3}],u={toc:c};function s(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,a.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"18-redux-toolkit"},"18 \u3010Redux Toolkit\u3011"),(0,r.kt)("p",null,"\u4e0a\u8fb9\u7684\u6848\u4f8b\u6211\u4eec\u4e00\u76f4\u5728\u4f7f\u7528Redux\u6838\u5fc3\u5e93\u6765\u4f7f\u7528Redux\uff0c\u9664\u4e86Redux\u6838\u5fc3\u5e93\u5916Redux\u8fd8\u4e3a\u6211\u4eec\u63d0\u4f9b\u4e86\u4e00\u79cd\u4f7f\u7528Redux\u7684\u65b9\u5f0f\u2014\u2014Redux Toolkit\u3002\u5b83\u7684\u540d\u5b57\u8d77\u7684\u975e\u5e38\u76f4\u767d\uff0cRedux\u5de5\u5177\u5305\uff0c\u7b80\u79f0RTK\u3002RTK\u53ef\u4ee5\u5e2e\u52a9\u6211\u4eec\u5904\u7406\u4f7f\u7528Redux\u8fc7\u7a0b\u4e2d\u7684\u91cd\u590d\u6027\u5de5\u4f5c\uff0c\u7b80\u5316Redux\u4e2d\u7684\u5404\u79cd\u64cd\u4f5c\u3002"),(0,r.kt)("h2",{id:"1redux-toolkit-\u6982\u89c8"},"1.Redux Toolkit \u6982\u89c8"),(0,r.kt)("h3",{id:"11--redux-toolkit-\u662f\u4ec0\u4e48"},"1.1  Redux Toolkit \u662f\u4ec0\u4e48\uff1f"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Redux Toolkit")," \u662f\u5b98\u65b9\u63a8\u8350\u7684\u7f16\u5199 ",(0,r.kt)("strong",{parentName:"p"},"Redux")," \u903b\u8f91\u7684\u65b9\u6cd5\u3002 \u5b83\u5305\u542b\u6211\u4eec\u5bf9\u4e8e\u6784\u5efa ",(0,r.kt)("strong",{parentName:"p"},"Redux")," \u5e94\u7528\u7a0b\u5e8f\u5fc5\u4e0d\u53ef\u5c11\u7684\u5305\u548c\u51fd\u6570\u3002 ",(0,r.kt)("strong",{parentName:"p"},"Redux Toolkit")," \u7684\u6784\u5efa\u7b80\u5316\u4e86\u5927\u591a\u6570 ",(0,r.kt)("strong",{parentName:"p"},"Redux")," \u4efb\u52a1\uff0c\u9632\u6b62\u4e86\u5e38\u89c1\u9519\u8bef\uff0c\u5e76\u4f7f\u7f16\u5199 ",(0,r.kt)("strong",{parentName:"p"},"Redux")," \u5e94\u7528\u7a0b\u5e8f\u53d8\u5f97\u66f4\u52a0\u5bb9\u6613\u3002\u53ef\u4ee5\u8bf4 ",(0,r.kt)("strong",{parentName:"p"},"Redux Toolkit")," \u5c31\u662f\u76ee\u524d ",(0,r.kt)("strong",{parentName:"p"},"Redux")," \u7684\u6700\u4f73\u5b9e\u8df5\u65b9\u5f0f\u3002"),(0,r.kt)("p",null,"\u4e3a\u4e86\u65b9\u4fbf\u540e\u9762\u5185\u5bb9\uff0c\u4e4b\u540e ",(0,r.kt)("strong",{parentName:"p"},"Redux Toolkit")," \u7b80\u79f0 ",(0,r.kt)("strong",{parentName:"p"},"RTK")),(0,r.kt)("h3",{id:"12-\u76ee\u7684"},"1.2 \u76ee\u7684"),(0,r.kt)("p",null,"Redux \u6838\u5fc3\u5e93\u662f\u6545\u610f\u8bbe\u8ba1\u6210\u975e\u5b9a\u5236\u5316\u7684\u6837\u5b50\uff08unopinionated\uff09\u3002\u600e\u4e48\u505a\u5b8c\u5168\u53d6\u51b3\u4e8e\u4f60\uff0c\u4f8b\u5982\u914d\u7f6e store\uff0c\u4f60\u7684 state \u5b58\u4ec0\u4e48\u4e1c\u897f\uff0c\u4ee5\u53ca\u5982\u4f55\u6784\u5efa reducer\u3002"),(0,r.kt)("p",null,"\u6709\u4e9b\u65f6\u5019\u8fd9\u6837\u633a\u597d\uff0c\u56e0\u4e3a\u6709\u5f88\u9ad8\u7684\u7075\u6d3b\u6027\uff0c\u4f46\u6211\u4eec\u53c8\u4e0d\u603b\u662f\u9700\u8981\u8fd9\u4e48\u9ad8\u7684\u81ea\u7531\u5ea6\u3002\u6709\u65f6\uff0c\u6211\u4eec\u53ea\u662f\u60f3\u4ee5\u6700\u7b80\u5355\u7684\u65b9\u5f0f\u4e0a\u624b\uff0c\u5e76\u60f3\u8981\u4e00\u4e9b\u826f\u597d\u7684\u9ed8\u8ba4\u884c\u4e3a\u80fd\u591f\u5f00\u7bb1\u5373\u7528\u3002\u6216\u8005\uff0c\u4e5f\u8bb8\u4f60\u6b63\u5728\u7f16\u5199\u4e00\u4e2a\u66f4\u5927\u7684\u5e94\u7528\u7a0b\u5e8f\u5e76\u53d1\u73b0\u81ea\u5df1\u6b63\u5728\u7f16\u5199\u4e00\u4e9b\u7c7b\u4f3c\u7684\u4ee3\u7801\uff0c\u800c\u4f60\u60f3\u51cf\u5c11\u5fc5\u987b\u624b\u5de5\u7f16\u5199\u7684\u4ee3\u7801\u91cf\u3002"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Redux Toolkit")," \u5b83\u6700\u521d\u662f\u4e3a\u4e86\u5e2e\u52a9\u89e3\u51b3\u6709\u5173 Redux \u7684\u4e09\u4e2a\u5e38\u89c1\u95ee\u9898\u800c\u521b\u5efa\u7684\uff1a"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},'"\u914d\u7f6e Redux store \u8fc7\u4e8e\u590d\u6742"'),(0,r.kt)("li",{parentName:"ul"},'"\u6211\u5fc5\u987b\u6dfb\u52a0\u5f88\u591a\u8f6f\u4ef6\u5305\u624d\u80fd\u5f00\u59cb\u4f7f\u7528 Redux"'),(0,r.kt)("li",{parentName:"ul"},'"Redux \u6709\u592a\u591a\u6837\u677f\u4ee3\u7801"')),(0,r.kt)("h3",{id:"13-\u4e3a\u4ec0\u4e48\u9700\u8981\u4f7f\u7528-redux-toolkit"},"1.3 \u4e3a\u4ec0\u4e48\u9700\u8981\u4f7f\u7528 Redux Toolkit"),(0,r.kt)("p",null,"\u901a\u8fc7\u9075\u5faa\u6211\u4eec\u63a8\u8350\u7684\u6700\u4f73\u5b9e\u8df5\uff0c\u63d0\u4f9b\u826f\u597d\u7684\u9ed8\u8ba4\u884c\u4e3a\uff0c\u6355\u83b7\u9519\u8bef\u5e76\u8ba9\u4f60\u7f16\u5199\u66f4\u7b80\u5355\u7684\u4ee3\u7801\uff0c",(0,r.kt)("strong",{parentName:"p"},"React Toolkit")," \u4f7f\u5f97\u7f16\u5199\u597d\u7684 Redux \u5e94\u7528\u7a0b\u5e8f\u4ee5\u53ca\u52a0\u5feb\u5f00\u53d1\u901f\u5ea6\u53d8\u5f97\u66f4\u52a0\u5bb9\u6613\u3002 Redux Toolkit \u5bf9",(0,r.kt)("strong",{parentName:"p"},"\u6240\u6709 Redux \u7528\u6237\u90fd\u6709\u5e2e\u52a9"),"\uff0c\u65e0\u8bba\u6280\u80fd\u6c34\u5e73\u6216\u8005\u7ecf\u9a8c\u5982\u4f55\u3002\u53ef\u4ee5\u5728\u65b0\u9879\u76ee\u5f00\u59cb\u65f6\u6dfb\u52a0\u5b83\uff0c\u4e5f\u53ef\u4ee5\u5728\u73b0\u6709\u9879\u76ee\u4e2d\u5c06\u5176\u7528\u4f5c\u589e\u91cf\u8fc1\u79fb\u7684\u4e00\u90e8\u5206\u3002"),(0,r.kt)("h3",{id:"14-\u6587\u6863\u94fe\u63a5"},"1.4 \u6587\u6863\u94fe\u63a5"),(0,r.kt)("p",null,"\u5b66\u4e60\u7684\u6700\u4f73\u65b9\u6cd5\u6211\u4e2a\u4eba\u89c9\u5f97\u8fd8\u662f\u770b\u5b98\u65b9\u6587\u6863\u6bd4\u8f83\u6743\u5a01\uff1a ",(0,r.kt)("a",{parentName:"p",href:"https://link.juejin.cn/?target=http%3A%2F%2Fcn.redux.js.org%2Fintroduction%2Fgetting-started"},"\u4e2d\u6587\u5b98\u65b9\u6587\u6863"),"\u3001",(0,r.kt)("a",{parentName:"p",href:"https://link.juejin.cn/?target=https%3A%2F%2Fredux-toolkit.js.org%2F"},"\u82f1\u6587\u5b98\u65b9\u6587\u6863"),"\u3002"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u7b80\u4ecb",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://redux-toolkit.js.org/introduction/quick-start"},"\u5feb\u901f\u5f00\u59cb")))),(0,r.kt)("li",{parentName:"ul"},"\u6559\u7a0b",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://redux-toolkit.js.org/tutorials/basic-tutorial"},"\u57fa\u7840\u6559\u7a0b")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://redux-toolkit.js.org/tutorials/intermediate-tutorial"},"\u4e2d\u7ea7\u6559\u7a0b")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://redux-toolkit.js.org/tutorials/advanced-tutorial"},"\u9ad8\u7ea7\u6559\u7a0b")))),(0,r.kt)("li",{parentName:"ul"},"\u4f7f\u7528 Redux Toolkit",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://redux-toolkit.js.org/usage/usage-guide"},"\u5165\u95e8")))),(0,r.kt)("li",{parentName:"ul"},"API \u6587\u6863",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://redux-toolkit.js.org/api/configureStore"},(0,r.kt)("inlineCode",{parentName:"a"},"configureStore"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://redux-toolkit.js.org/api/getDefaultMiddleware"},(0,r.kt)("inlineCode",{parentName:"a"},"getDefaultMiddleware"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://redux-toolkit.js.org/api/createReducer"},(0,r.kt)("inlineCode",{parentName:"a"},"createReducer"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://redux-toolkit.js.org/api/createAction"},(0,r.kt)("inlineCode",{parentName:"a"},"createAction"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://redux-toolkit.js.org/api/createSlice"},(0,r.kt)("inlineCode",{parentName:"a"},"createSlice"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://redux-toolkit.js.org/api/createSelector"},(0,r.kt)("inlineCode",{parentName:"a"},"createSelector"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://redux-toolkit.js.org/api/other-exports"},"\u5176\u4ed6 Export"))))),(0,r.kt)("h2",{id:"2\u5b89\u88c5"},"2.\u5b89\u88c5"),(0,r.kt)("p",null,"\u5b89\u88c5\uff0c\u65e0\u8bba\u662fRTK\u8fd8\u662fRedux\uff0c\u5728React\u4e2d\u4f7f\u7528\u65f6react-redux\u90fd\u662f\u5fc5\u4e0d\u53ef\u5c11\uff0c\u6240\u4ee5\u4f7f\u7528RTK\u4f9d\u7136\u9700\u8981\u5b89\u88c5\u4e24\u4e2a\u5305\uff1areact-redux\u548c@reduxjs/toolkit\u3002"),(0,r.kt)("p",null,"npm"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"npm install react-redux @reduxjs/toolkit -S\n")),(0,r.kt)("p",null,"yarn"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"yarn add react-redux @reduxjs/toolkit\n")),(0,r.kt)("p",null,"\u5728\u5b98\u65b9\u6587\u6863\u4e2d\u5176\u5b9e\u63d0\u4f9b\u4e86\u5b8c\u6574\u7684 ",(0,r.kt)("strong",{parentName:"p"},"RTK")," \u9879\u76ee\u521b\u5efa\u547d\u4ee4\uff0c\u4f46\u54b1\u4eec\u5b66\u4e60\u5c31\u4ece\u57fa\u7840\u7684\u642d\u5efa\u5f00\u59cb\u5427\u3002"),(0,r.kt)("h2",{id:"3\u57fa\u7840\u5f00\u53d1\u6d41\u7a0b"},"3.\u57fa\u7840\u5f00\u53d1\u6d41\u7a0b"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"\u5b89\u88c5\u5b8c\u76f8\u5173\u5305\u4ee5\u540e\u5f00\u59cb\u7f16\u5199\u57fa\u672c\u7684 ",(0,r.kt)("strong",{parentName:"p"},"RTK")," \u7a0b\u5e8f")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u521b\u5efa\u4e00\u4e2astore\u6587\u4ef6\u5939"),(0,r.kt)("li",{parentName:"ul"},"\u521b\u5efa\u4e00\u4e2aindex.ts\u505a\u4e3a\u4e3b\u5165\u53e3"),(0,r.kt)("li",{parentName:"ul"},"\u521b\u5efa\u4e00\u4e2afestures\u6587\u4ef6\u5939\u7528\u6765\u88c5\u6240\u6709\u7684store"),(0,r.kt)("li",{parentName:"ul"},"\u521b\u5efa\u4e00\u4e2acounterSlice.js\u6587\u4ef6\uff0c\u5e76\u5bfc\u51fa\u7b80\u5355\u7684\u52a0\u51cf\u65b9\u6cd5")),(0,r.kt)("h3",{id:"31-\u521b\u5efa-redux-state-slice"},"3.1 \u521b\u5efa Redux State Slice"),(0,r.kt)("p",null,"\u521b\u5efa slice \u9700\u8981\u4e00\u4e2a\u5b57\u7b26\u4e32\u540d\u79f0\u6765\u6807\u8bc6\u5207\u7247\u3001\u4e00\u4e2a\u521d\u59cb state \u4ee5\u53ca\u4e00\u4e2a\u6216\u591a\u4e2a\u5b9a\u4e49\u4e86\u8be5\u5982\u4f55\u66f4\u65b0 state \u7684 reducer \u51fd\u6570\u3002slice \u521b\u5efa\u540e \uff0c\u6211\u4eec\u53ef\u4ee5\u5bfc\u51fa slice \u4e2d\u751f\u6210\u7684 Redux action creators \u548c reducer \u51fd\u6570\u3002"),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://i0.hdslb.com/bfs/album/25d2cece6e104dafc01ff6febf4205f0faafe145.png",alt:"image-20221031123543763"})),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"store/features/counterSlice.js")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"import { createSlice } from '@reduxjs/toolkit'\n\nconst initialState = {\n  value: 0,\n}\n\n// \u521b\u5efa\u4e00\u4e2aSlice\nexport const counterSlice = createSlice({\n  name: 'counter',\n  initialState,\n  reducers: {\n    // \u5b9a\u4e49\u4e00\u4e2a\u52a0\u7684\u65b9\u6cd5\n    increment: state => {\n      state.value += 1\n    },\n    // \u5b9a\u4e49\u4e00\u4e2a\u51cf\u7684\u65b9\u6cd5\n    decrement: state => {\n      state.value -= 1\n    },\n  },\n})\nconsole.log('counterSlice', counterSlice)\nconsole.log('counterSlice.actions', counterSlice.actions)\n\n// \u5bfc\u51fa\u52a0\u51cf\u65b9\u6cd5\nexport const { increment, decrement } = counterSlice.actions\n\n// \u66b4\u9732reducer\nexport default counterSlice.reducer\n")),(0,r.kt)("p",null,"createSlice\u662f\u4e00\u4e2a\u5168\u81ea\u52a8\u7684\u521b\u5efareducer\u5207\u7247\u7684\u65b9\u6cd5\uff0c\u5728\u5b83\u7684\u5185\u90e8\u8c03\u7528\u5c31\u662fcreateAction\u548ccreateReducer\uff0c\u4e4b\u6240\u4ee5\u5148\u4ecb\u7ecd\u90a3\u4e24\u4e2a\u4e5f\u662f\u8fd9\u4e2a\u539f\u56e0\u3002createSlice\u9700\u8981\u4e00\u4e2a\u5bf9\u8c61\u4f5c\u4e3a\u53c2\u6570\uff0c\u5bf9\u8c61\u4e2d\u901a\u8fc7\u4e0d\u540c\u7684\u5c5e\u6027\u6765\u6307\u5b9areducer\u7684\u914d\u7f6e\u4fe1\u606f\u3002"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"createSlice(configuration object)")),(0,r.kt)("p",null,"\u914d\u7f6e\u5bf9\u8c61\u4e2d\u7684\u5c5e\u6027\uff1a"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"name")," \u2014\u2014 reducer\u7684\u540d\u5b57\uff0c\u4f1a\u4f5c\u4e3aaction\u4e2dtype\u5c5e\u6027\u7684\u524d\u7f00\uff0c\u4e0d\u8981\u91cd\u590d")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"initialState")," \u2014\u2014 state\u7684\u521d\u59cb\u503c")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"reducers")," \u2014\u2014 reducer\u7684\u5177\u4f53\u65b9\u6cd5\uff0c\u9700\u8981\u4e00\u4e2a\u5bf9\u8c61\u4f5c\u4e3a\u53c2\u6570\uff0c\u53ef\u4ee5\u4ee5\u65b9\u6cd5\u7684\u5f62\u5f0f\u6dfb\u52a0reducer\uff0cRTK\u4f1a\u81ea\u52a8\u751f\u6210action\u5bf9\u8c61\u3002"))),(0,r.kt)("p",null,"\u603b\u7684\u6765\u8bf4\uff0c\u4f7f\u7528",(0,r.kt)("inlineCode",{parentName:"p"},"createSlice"),"\u521b\u5efa\u5207\u7247\u540e\uff0c\u5207\u7247\u4f1a\u81ea\u52a8\u6839\u636e\u914d\u7f6e\u5bf9\u8c61\u751f\u6210action\u548creducer\uff0caction\u9700\u8981\u5bfc\u51fa\u7ed9\u8c03\u7528\u5904\uff0c\u8c03\u7528\u5904\u53ef\u4ee5\u4f7f\u7528action\u4f5c\u4e3adispatch\u7684\u53c2\u6570\u89e6\u53d1state\u7684\u4fee\u6539\u3002reducer\u9700\u8981\u4f20\u9012\u7ed9configureStore\u4ee5\u4f7f\u5176\u5728\u4ed3\u5e93\u4e2d\u751f\u6548\u3002"),(0,r.kt)("p",null,"\u6211\u4eec\u53ef\u4ee5\u770b\u770b",(0,r.kt)("inlineCode",{parentName:"p"},"counterSlice"),"\u548c",(0,r.kt)("inlineCode",{parentName:"p"},"counterSlice.actions"),"\u662f\u4ec0\u4e48\u6837\u5b50"),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://i0.hdslb.com/bfs/album/684818e55ffb553b7e892c4da0c9241a9c9635aa.png",alt:"image-20221031124548096"})),(0,r.kt)("h3",{id:"32-\u5c06-slice-reducers-\u6dfb\u52a0\u5230-store-\u4e2d"},"3.2 \u5c06 Slice Reducers \u6dfb\u52a0\u5230 Store \u4e2d"),(0,r.kt)("p",null,"\u4e0b\u4e00\u6b65\uff0c\u6211\u4eec\u9700\u8981\u4ece\u8ba1\u6570\u5207\u7247\u4e2d\u5f15\u5165 reducer \u51fd\u6570\uff0c\u5e76\u5c06\u5b83\u6dfb\u52a0\u5230\u6211\u4eec\u7684 store \u4e2d\u3002\u901a\u8fc7\u5728 reducer \u53c2\u6570\u4e2d\u5b9a\u4e49\u4e00\u4e2a\u5b57\u6bb5\uff0c\u6211\u4eec\u544a\u8bc9 store \u4f7f\u7528\u8fd9\u4e2a slice reducer \u51fd\u6570\u6765\u5904\u7406\u5bf9\u8be5\u72b6\u6001\u7684\u6240\u6709\u66f4\u65b0\u3002"),(0,r.kt)("p",null,"\u6211\u4eec\u4ee5\u524d\u76f4\u63a5\u7528",(0,r.kt)("inlineCode",{parentName:"p"},"redux"),"\u662f\u8fd9\u6837\u7684"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"const reducer = combineReducers({\n    counter:counterReducers\n});\n\nconst store = createStore(reducer);\n")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"store/index.js")),(0,r.kt)("p",null,"\u5207\u7247\u7684reducer\u5c5e\u6027\u662f\u5207\u7247\u6839\u636e\u6211\u4eec\u4f20\u9012\u7684\u65b9\u6cd5\u81ea\u52a8\u521b\u5efa\u751f\u6210\u7684reducer\uff0c\u9700\u8981\u5c06\u5176\u4f5c\u4e3areducer\u4f20\u9012\u8fdbconfigureStore\u7684\u914d\u7f6e\u5bf9\u8c61\u4e2d\u4ee5\u4f7f\u5176\u751f\u6548\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"import { configureStore } from '@reduxjs/toolkit'\nimport counterSlice from './features/counterSlice'\n\n// configureStore\u521b\u5efa\u4e00\u4e2aredux\u6570\u636e\nconst store = configureStore({\n  // \u5408\u5e76\u591a\u4e2aSlice\n  reducer: {\n    counter: counterSlice,\n  },\n})\n\nexport default store\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"configureStore"),"\u9700\u8981\u4e00\u4e2a\u5bf9\u8c61\u4f5c\u4e3a\u53c2\u6570\uff0c\u5728\u8fd9\u4e2a\u5bf9\u8c61\u4e2d\u53ef\u4ee5\u901a\u8fc7\u4e0d\u540c\u7684\u5c5e\u6027\u6765\u5bf9store\u8fdb\u884c\u8bbe\u7f6e\uff0c\u6bd4\u5982\uff1areducer\u5c5e\u6027\u7528\u6765\u8bbe\u7f6estore\u4e2d\u5173\u8054\u5230\u7684reducer\uff0cpreloadedState\u7528\u6765\u6307\u5b9astate\u7684\u521d\u59cb\u503c\u7b49\uff0c\u8fd8\u6709\u4e00\u4e9b\u503c\u6211\u4eec\u4f1a\u653e\u5230\u540e\u8fb9\u8bb2\u89e3\u3002")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"reducer"),"\u5c5e\u6027\u53ef\u4ee5\u76f4\u63a5\u4f20\u9012\u4e00\u4e2areducer\uff0c\u4e5f\u53ef\u4ee5\u4f20\u9012\u4e00\u4e2a\u5bf9\u8c61\u4f5c\u4e3a\u503c\u3002\u5982\u679c\u53ea\u4f20\u9012\u4e00\u4e2areducer\uff0c\u5219\u610f\u5473\u7740store\u4e2d\u53ea\u6709\u4e00\u4e2areducer\u3002\u82e5\u4f20\u9012\u4e00\u4e2a\u5bf9\u8c61\u4f5c\u4e3a\u53c2\u6570\uff0c\u5bf9\u8c61\u7684\u6bcf\u4e2a\u5c5e\u6027\u90fd\u53ef\u4ee5\u6267\u884c\u4e00\u4e2areducer\uff0c\u5728\u65b9\u6cd5\u5185\u90e8\u5b83\u4f1a\u81ea\u52a8\u5bf9\u8fd9\u4e9breducer\u8fdb\u884c\u5408\u5e76\u3002"))),(0,r.kt)("h3",{id:"33-store\u52a0\u5230\u5168\u5c40"},"3.3 store\u52a0\u5230\u5168\u5c40"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"main.js")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-jsx"},"import React from 'react'\nimport ReactDOM from 'react-dom/client'\nimport App from './App'\n\n// redux toolkit\nimport { Provider } from 'react-redux'\nimport store from './store'\n\nReactDOM.createRoot(document.getElementById('root')).render(\n  <Provider store={store}>\n    <App />\n  </Provider>,\n)\n")),(0,r.kt)("h3",{id:"34-\u5728-react-\u7ec4\u4ef6\u4e2d\u4f7f\u7528-redux-\u72b6\u6001\u548c\u64cd\u4f5c"},"3.4 \u5728 React \u7ec4\u4ef6\u4e2d\u4f7f\u7528 Redux \u72b6\u6001\u548c\u64cd\u4f5c"),(0,r.kt)("p",null,"\u73b0\u5728\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 React-Redux \u94a9\u5b50\u8ba9 React \u7ec4\u4ef6\u4e0e Redux store \u4ea4\u4e92\u3002\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"useSelector")," \u4ece store \u4e2d\u8bfb\u53d6\u6570\u636e\uff0c\u4f7f\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"useDispatch")," dispatch actions\u3002"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"App.jsx")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-jsx"},"import React from 'react'\nimport { useDispatch, useSelector } from 'react-redux'\n// \u5f15\u5165\u5bf9\u5e94\u7684\u65b9\u6cd5\nimport { increment, decrement } from './store/features/counterSlice'\n\nexport default function App() {\n  const count = useSelector(state => state.counter.value)\n  const dispatch = useDispatch()\n\n  return (\n    <div style={{ width: 100, margin: '100px auto' }}>\n      <button onClick={() => dispatch(increment())}>+</button>\n      <span>{count}</span>\n      <button onClick={() => dispatch(decrement())}>-</button>\n    </div>\n  )\n}\n")),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://i0.hdslb.com/bfs/album/826b0650e7680a37377945d4af438e5781653601.png",alt:"image-20221031125215129"})),(0,r.kt)("p",null,"\u73b0\u5728\uff0c\u6bcf\u5f53\u4f60\u70b9\u51fb\u201d\u9012\u589e\u201c\u548c\u201c\u9012\u51cf\u201d\u6309\u94ae\u3002"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u4f1a dispatch \u5bf9\u5e94\u7684 Redux action \u5230 store"),(0,r.kt)("li",{parentName:"ul"},"\u5728\u8ba1\u6570\u5668\u5207\u7247\u5bf9\u5e94\u7684 reducer \u4e2d\u5c06\u770b\u5230 action \u5e76\u66f4\u65b0\u5176\u72b6\u6001"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"<App>"),"\u7ec4\u4ef6\u5c06\u4ece store \u4e2d\u770b\u5230\u65b0\u7684\u72b6\u6001\uff0c\u5e76\u4f7f\u7528\u65b0\u6570\u636e\u91cd\u65b0\u6e32\u67d3\u7ec4\u4ef6")),(0,r.kt)("h3",{id:"35-\u5c0f\u603b\u7ed3"},"3.5 \u5c0f\u603b\u7ed3"),(0,r.kt)("p",null,"\u8fd9\u662f\u5173\u4e8e\u5982\u4f55\u901a\u8fc7 React \u8bbe\u7f6e\u548c\u4f7f\u7528 Redux Toolkit \u7684\u7b80\u8981\u6982\u8ff0\u3002 \u56de\u987e\u7ec6\u8282\uff1a"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u4f7f\u7528",(0,r.kt)("inlineCode",{parentName:"p"},"configureStore"),"\u521b\u5efa Redux store"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"configureStore")," \u63a5\u53d7 ",(0,r.kt)("inlineCode",{parentName:"li"},"reducer")," \u51fd\u6570\u4f5c\u4e3a\u547d\u540d\u53c2\u6570"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"configureStore")," \u4f7f\u7528\u7684\u597d\u7528\u7684\u9ed8\u8ba4\u8bbe\u7f6e\u81ea\u52a8\u8bbe\u7f6e store"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u4e3a React \u5e94\u7528\u7a0b\u5e8f\u7ec4\u4ef6\u63d0\u4f9b Redux store"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"\u4f7f\u7528 React-Redux ",(0,r.kt)("inlineCode",{parentName:"li"},"<Provider>")," \u7ec4\u4ef6\u5305\u88f9\u4f60\u7684 ",(0,r.kt)("inlineCode",{parentName:"li"},"<App />")),(0,r.kt)("li",{parentName:"ul"},"\u4f20\u9012 Redux store \u5982 ",(0,r.kt)("inlineCode",{parentName:"li"},"<Provider store={store}>")))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u4f7f\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"createSlice"),' \u521b\u5efa Redux "slice" reducer'),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u4f7f\u7528\u5b57\u7b26\u4e32\u540d\u79f0\u3001\u521d\u59cb\u72b6\u6001\u548c\u547d\u540d\u7684 reducer \u51fd\u6570\u8c03\u7528\u201ccreateSlice\u201d")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Reducer \u51fd\u6570\u53ef\u4ee5\u4f7f\u7528 Immer \u6765\u201c\u6539\u53d8\u201d\u72b6\u6001")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u5bfc\u51fa\u751f\u6210\u7684 slice reducer \u548c action creators")))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u5728 React \u7ec4\u4ef6\u4e2d\u4f7f\u7528 React-Redux ",(0,r.kt)("inlineCode",{parentName:"p"},"useSelector/useDispatch")," \u94a9\u5b50"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u4f7f\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"useSelector")," \u94a9\u5b50\u4ece store \u4e2d\u8bfb\u53d6\u6570\u636e")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u4f7f\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"useDispatch")," \u94a9\u5b50\u83b7\u53d6 ",(0,r.kt)("inlineCode",{parentName:"p"},"dispatch")," \u51fd\u6570\uff0c\u5e76\u6839\u636e\u9700\u8981 dispatch actions"))))),(0,r.kt)("h2",{id:"4\u8865\u5145\u89e3\u6790\u4e0a\u9762\u8ba1\u6570\u5668\u6848\u4f8b"},"4.\u8865\u5145\u89e3\u6790\u4e0a\u9762\u8ba1\u6570\u5668\u6848\u4f8b"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"\u8fd9\u4e2a\u5de5\u5177\u5e2e\u6211\u4eec\u5c01\u88c5\u597d\u4e86\u5f88\u591a\u64cd\u4f5c\uff0c\u867d\u7136\u5f88\u65b9\u4fbf\uff0c\u4f46\u662f\u521a\u4f7f\u7528\u5f88\u591a\u5730\u65b9\u4e0d\u662f\u90a3\u4e48\u4e60\u60ef\u3002"),(0,r.kt)("p",{parentName:"blockquote"},"\u6bcf\u4e2a\u6587\u4ef6\u7684\u4ee3\u7801\u5c31\u4e0d\u8d34\u4e86\uff0c\u548c\u4e0a\u9762\u4e00\u6837\u7684\uff0c\u53ef\u4ee5\u590d\u5236\u5230\u6587\u672c\u7ed3\u5408\u770b")),(0,r.kt)("h3",{id:"41-\u521b\u5efa-slice-reducer-\u548c-action"},"4.1 \u521b\u5efa Slice Reducer \u548c Action"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"store/features/counterSlice.js")),(0,r.kt)("p",null,"\u65e9\u4e9b\u65f6\u5019\uff0c\u6211\u4eec\u770b\u5230\u5355\u51fb\u89c6\u56fe\u4e2d\u7684\u4e0d\u540c\u6309\u94ae\u4f1a dispatch \u4e09\u79cd\u4e0d\u540c\u7c7b\u578b\u7684 Redux action\uff1a"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},'{type: "counter/increment"}')),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},'{type: "counter/decrement"}')),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},'{type: "counter/incrementByAmount"}'))),(0,r.kt)("p",null,"\u6211\u4eec\u77e5\u9053 action \u662f\u5e26\u6709 ",(0,r.kt)("inlineCode",{parentName:"p"},"type")," \u5b57\u6bb5\u7684\u666e\u901a\u5bf9\u8c61\uff0c",(0,r.kt)("inlineCode",{parentName:"p"},"type")," \u5b57\u6bb5\u603b\u662f\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c\u5e76\u4e14\u6211\u4eec\u901a\u5e38\u6709 action creator \u51fd\u6570\u6765\u521b\u5efa\u548c\u8fd4\u56de action \u5bf9\u8c61\u3002\u90a3\u4e48\u5728\u54ea\u91cc\u5b9a\u4e49 action \u5bf9\u8c61\u3001\u7c7b\u578b\u5b57\u7b26\u4e32\u548c action creator \u5462\uff1f"),(0,r.kt)("p",null,"\u6211\u4eec",(0,r.kt)("em",{parentName:"p"},"\u53ef\u4ee5"),"\u6bcf\u6b21\u90fd\u624b\u5199\u3002\u4f46\u662f\uff0c\u90a3\u4f1a\u5f88\u4e4f\u5473\u3002\u6b64\u5916\uff0cRedux \u4e2d",(0,r.kt)("em",{parentName:"p"},"\u771f\u6b63"),"\u91cd\u8981\u7684\u662f reducer \u51fd\u6570\uff0c\u4ee5\u53ca\u5176\u4e2d\u8ba1\u7b97\u65b0\u72b6\u6001\u7684\u903b\u8f91\u3002"),(0,r.kt)("p",null,"Redux Toolkit \u6709\u4e00\u4e2a\u540d\u4e3a ",(0,r.kt)("inlineCode",{parentName:"p"},"createSlice")," \u7684\u51fd\u6570\uff0c\u5b83\u8d1f\u8d23\u751f\u6210 action \u7c7b\u578b\u5b57\u7b26\u4e32\u3001action creator \u51fd\u6570\u548c action \u5bf9\u8c61\u7684\u5de5\u4f5c\u3002\u4f60\u6240\u8981\u505a\u7684\u5c31\u662f\u4e3a\u8fd9\u4e2a slice \u5b9a\u4e49\u4e00\u4e2a\u540d\u79f0\uff0c\u7f16\u5199\u4e00\u4e2a\u5305\u542b reducer \u51fd\u6570\u7684\u5bf9\u8c61\uff0c\u5b83\u4f1a\u81ea\u52a8\u751f\u6210\u76f8\u5e94\u7684 action \u4ee3\u7801\u3002",(0,r.kt)("inlineCode",{parentName:"p"},"name")," \u9009\u9879\u7684\u5b57\u7b26\u4e32\u7528\u4f5c\u6bcf\u4e2a action \u7c7b\u578b\u7684\u7b2c\u4e00\u90e8\u5206\uff0c\u6bcf\u4e2a reducer \u51fd\u6570\u7684\u952e\u540d\u7528\u4f5c\u7b2c\u4e8c\u90e8\u5206\u3002\u56e0\u6b64\uff0c",(0,r.kt)("inlineCode",{parentName:"p"},'"counter"')," \u540d\u79f0 + ",(0,r.kt)("inlineCode",{parentName:"p"},'"increment"')," reducer \u51fd\u6570\u751f\u6210\u4e86\u4e00\u4e2a action \u7c7b\u578b ",(0,r.kt)("inlineCode",{parentName:"p"},'{type: "counter/increment"}'),"\u3002\uff08\u6bd5\u7adf\uff0c\u5982\u679c\u8ba1\u7b97\u673a\u53ef\u4ee5\u4e3a\u6211\u4eec\u505a\uff0c\u4e3a\u4ec0\u4e48\u8981\u624b\u5199\uff01\uff09"),(0,r.kt)("p",null,"\u9664\u4e86 ",(0,r.kt)("inlineCode",{parentName:"p"},"name")," \u5b57\u6bb5\uff0c",(0,r.kt)("inlineCode",{parentName:"p"},"createSlice")," \u8fd8\u9700\u8981\u6211\u4eec\u4e3a reducer \u4f20\u5165\u521d\u59cb\u72b6\u6001\u503c\uff0c\u4ee5\u4fbf\u5728\u7b2c\u4e00\u6b21\u8c03\u7528\u65f6\u5c31\u6709\u4e00\u4e2a ",(0,r.kt)("inlineCode",{parentName:"p"},"state"),"\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u63d0\u4f9b\u4e86\u4e00\u4e2a\u5bf9\u8c61\uff0c\u5b83\u6709\u4e00\u4e2a\u4ece 0 \u5f00\u59cb\u7684 ",(0,r.kt)("inlineCode",{parentName:"p"},"value")," \u5b57\u6bb5\u3002"),(0,r.kt)("p",null,"\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u8fd9\u91cc\u6709\u4e09\u4e2a reducer \u51fd\u6570\uff0c\u5b83\u4eec\u5bf9\u5e94\u4e8e\u901a\u8fc7\u5355\u51fb\u4e0d\u540c\u6309\u94ae dispatch \u7684\u4e09\u79cd\u4e0d\u540c\u7684 action \u7c7b\u578b\u3002"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"createSlice")," \u4f1a\u81ea\u52a8\u751f\u6210\u4e0e\u6211\u4eec\u7f16\u5199\u7684 reducer \u51fd\u6570\u540c\u540d\u7684 action creator\u3002\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u8c03\u7528\u5176\u4e2d\u4e00\u4e2a\u6765\u68c0\u67e5\u5b83\u5e76\u67e5\u770b\u5b83\u8fd4\u56de\u7684\u5185\u5bb9\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'console.log(counterSlice.actions.increment())\n// {type: "counter/increment"}\n')),(0,r.kt)("p",null,"\u5b83\u8fd8\u751f\u6210\u77e5\u9053\u5982\u4f55\u54cd\u5e94\u6240\u6709\u8fd9\u4e9b action \u7c7b\u578b\u7684 slice reducer \u51fd\u6570\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"const newState = counterSlice.reducer(\n  { value: 10 },\n  counterSlice.actions.increment()\n)\nconsole.log(newState)\n// {value: 11}\n")),(0,r.kt)("h3",{id:"42-reducer-\u7684\u89c4\u5219"},"4.2 Reducer \u7684\u89c4\u5219"),(0,r.kt)("p",null,"Reducer \u5fc5\u9700\u7b26\u5408\u4ee5\u4e0b\u89c4\u5219\uff1a"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u4ec5\u4f7f\u7528 ",(0,r.kt)("inlineCode",{parentName:"li"},"state")," \u548c ",(0,r.kt)("inlineCode",{parentName:"li"},"action")," \u53c2\u6570\u8ba1\u7b97\u65b0\u7684\u72b6\u6001\u503c"),(0,r.kt)("li",{parentName:"ul"},"\u7981\u6b62\u76f4\u63a5\u4fee\u6539 ",(0,r.kt)("inlineCode",{parentName:"li"},"state"),"\u3002\u5fc5\u987b\u901a\u8fc7\u590d\u5236\u73b0\u6709\u7684 ",(0,r.kt)("inlineCode",{parentName:"li"},"state")," \u5e76\u5bf9\u590d\u5236\u7684\u503c\u8fdb\u884c\u66f4\u6539\u7684\u65b9\u5f0f\u6765\u505a ",(0,r.kt)("em",{parentName:"li"},"\u4e0d\u53ef\u53d8\u66f4\u65b0\uff08immutable updates\uff09"),"\u3002"),(0,r.kt)("li",{parentName:"ul"},"\u7981\u6b62\u4efb\u4f55\u5f02\u6b65\u903b\u8f91\u3001\u4f9d\u8d56\u968f\u673a\u503c\u6216\u5bfc\u81f4\u5176\u4ed6\u201c\u526f\u4f5c\u7528\u201d\u7684\u4ee3\u7801")),(0,r.kt)("p",null,"\u4f46\u4e3a\u4ec0\u4e48\u8fd9\u4e9b\u89c4\u5219\u5f88\u91cd\u8981\uff1f\u6709\u51e0\u4e2a\u4e0d\u540c\u7684\u539f\u56e0\uff1a"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Redux \u7684\u76ee\u6807\u4e4b\u4e00\u662f\u4f7f\u4f60\u7684\u4ee3\u7801\u53ef\u9884\u6d4b\u3002\u5f53\u51fd\u6570\u7684\u8f93\u51fa\u4ec5\u6839\u636e\u8f93\u5165\u53c2\u6570\u8ba1\u7b97\u65f6\uff0c\u66f4\u5bb9\u6613\u7406\u89e3\u8be5\u4ee3\u7801\u7684\u5de5\u4f5c\u539f\u7406\u5e76\u5bf9\u5176\u8fdb\u884c\u6d4b\u8bd5\u3002"),(0,r.kt)("li",{parentName:"ul"},"\u53e6\u4e00\u65b9\u9762\uff0c\u5982\u679c\u4e00\u4e2a\u51fd\u6570\u4f9d\u8d56\u4e8e\u81ea\u8eab\u4e4b\u5916\u7684\u53d8\u91cf\uff0c\u6216\u8005\u884c\u4e3a\u968f\u673a\uff0c\u4f60\u6c38\u8fdc\u4e0d\u77e5\u9053\u8fd0\u884c\u5b83\u65f6\u4f1a\u53d1\u751f\u4ec0\u4e48\u3002")),(0,r.kt)("p",null,"\u201c\u4e0d\u53ef\u53d8\u66f4\u65b0\uff08Immutable Updates\uff09\u201d \u8fd9\u4e2a\u89c4\u5219\u5c24\u5176\u91cd\u8981\uff0c\u503c\u5f97\u8fdb\u4e00\u6b65\u8ba8\u8bba\u3002"),(0,r.kt)("h3",{id:"43-reducer-\u4e0e-immutable-\u66f4\u65b0"},"4.3 Reducer \u4e0e Immutable \u66f4\u65b0"),(0,r.kt)("p",null,"\u524d\u9762\u8bb2\u8fc7 \u201cmutation\u201d\uff08\u66f4\u65b0\u5df2\u6709\u5bf9\u8c61/\u6570\u7ec4\u7684\u503c\uff09\u4e0e \u201cimmutability\u201d\uff08\u8ba4\u4e3a\u503c\u662f\u4e0d\u53ef\u4ee5\u6539\u53d8\u7684\uff09"),(0,r.kt)("p",null,"\u5728 Redux \u4e2d\uff0c",(0,r.kt)("strong",{parentName:"p"},"*\u6c38\u8fdc","*"," \u4e0d\u5141\u8bb8\u5728 reducer \u4e2d\u66f4\u6539 state \u7684\u539f\u59cb\u5bf9\u8c61\uff01")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"// \u274c \u975e\u6cd5 - \u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u8fd9\u5c06\u66f4\u6539 state\uff01\nstate.value = 123\n")),(0,r.kt)("p",null,"\u4e0d\u80fd\u5728 Redux \u4e2d\u66f4\u6539 state \u6709\u51e0\u4e2a\u539f\u56e0\uff1a"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u5b83\u4f1a\u5bfc\u81f4 bug\uff0c\u4f8b\u5982\u89c6\u56fe\u672a\u6b63\u786e\u66f4\u65b0\u4ee5\u663e\u793a\u6700\u65b0\u503c"),(0,r.kt)("li",{parentName:"ul"},"\u66f4\u96be\u7406\u89e3\u72b6\u6001\u66f4\u65b0\u7684\u539f\u56e0\u548c\u65b9\u5f0f"),(0,r.kt)("li",{parentName:"ul"},"\u7f16\u5199\u6d4b\u8bd5\u53d8\u5f97\u66f4\u52a0\u56f0\u96be"),(0,r.kt)("li",{parentName:"ul"},"\u5b83\u8fdd\u80cc\u4e86 Redux \u7684\u9884\u671f\u7cbe\u795e\u548c\u4f7f\u7528\u6a21\u5f0f")),(0,r.kt)("p",null,"\u6240\u4ee5\u5982\u679c\u6211\u4eec\u4e0d\u80fd\u66f4\u6539\u539f\u4ef6\uff0c\u6211\u4eec\u5982\u4f55\u8fd4\u56de\u66f4\u65b0\u7684\u72b6\u6001\u5462\uff1f"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Reducer \u4e2d\u5fc5\u9700\u8981\u5148\u521b\u5efa\u539f\u59cb\u503c\u7684\u526f\u672c\uff0c\u7136\u540e\u53ef\u4ee5\u6539\u53d8\u526f\u672c\u3002")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"// \u2705 \u8fd9\u6837\u64cd\u4f5c\u662f\u5b89\u5168\u7684\uff0c\u56e0\u4e3a\u521b\u5efa\u4e86\u526f\u672c\nreturn {\n  ...state,\n  value: 123\n}\n")),(0,r.kt)("p",null,"\u6211\u4eec\u5df2\u7ecf\u770b\u5230\u6211\u4eec\u53ef\u4ee5",(0,r.kt)("a",{parentName:"p",href:"https://cn.redux.js.org/tutorials/essentials/part-1-overview-concepts#immutability"},"\u624b\u52a8\u7f16\u5199 immutable \u66f4\u65b0"),"\u3002\u4f46\u662f\uff0c\u624b\u52a8\u7f16\u5199\u4e0d\u53ef\u53d8\u7684\u66f4\u65b0\u903b\u8f91\u786e\u5b9e\u7e41\u7410\uff0c\u800c\u4e14\u5728 reducer \u4e2d\u610f\u5916\u6539\u53d8\u72b6\u6001\u662f Redux \u7528\u6237\u6700\u5e38\u72af\u7684\u4e00\u4e2a\u9519\u8bef\u3002"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"\u8fd9\u5c31\u662f\u4e3a\u4ec0\u4e48 Redux Toolkit \u7684 ",(0,r.kt)("inlineCode",{parentName:"strong"},"createSlice")," \u51fd\u6570\u53ef\u4ee5\u8ba9\u4f60\u4ee5\u66f4\u7b80\u5355\u7684\u65b9\u5f0f\u7f16\u5199\u4e0d\u53ef\u53d8\u66f4\u65b0\uff01")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"createSlice")," \u5185\u90e8\u4f7f\u7528\u4e86\u4e00\u4e2a\u540d\u4e3a ",(0,r.kt)("a",{parentName:"p",href:"https://immerjs.github.io/immer/"},"Immer")," \u7684\u5e93\u3002 Immer \u4f7f\u7528\u4e00\u79cd\u79f0\u4e3a \u201cProxy\u201d \u7684\u7279\u6b8a JS \u5de5\u5177\u6765\u5305\u88c5\u4f60\u63d0\u4f9b\u7684\u6570\u636e\uff0c\u5f53\u4f60\u5c1d\u8bd5 \u201dmutate\u201c \u8fd9\u4e9b\u6570\u636e\u7684\u65f6\u5019\uff0c\u5947\u8ff9\u53d1\u751f\u4e86\uff0c",(0,r.kt)("strong",{parentName:"p"},"Immer \u4f1a\u8ddf\u8e2a\u4f60\u5c1d\u8bd5\u8fdb\u884c\u7684\u6240\u6709\u66f4\u6539\uff0c\u7136\u540e\u4f7f\u7528\u8be5\u66f4\u6539\u5217\u8868\u8fd4\u56de\u4e00\u4e2a\u5b89\u5168\u7684\u3001\u4e0d\u53ef\u53d8\u7684\u66f4\u65b0\u503c"),"\uff0c\u5c31\u597d\u50cf\u4f60\u624b\u52a8\u7f16\u5199\u4e86\u6240\u6709\u4e0d\u53ef\u53d8\u7684\u66f4\u65b0\u903b\u8f91\u4e00\u6837\u3002"),(0,r.kt)("p",null,"\u6240\u4ee5\uff0c\u4e0b\u9762\u7684\u4ee3\u7801\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"function handwrittenReducer(state, action) {\n  return {\n    ...state,\n    first: {\n      ...state.first,\n      second: {\n        ...state.first.second,\n        [action.someId]: {\n          ...state.first.second[action.someId],\n          fourth: action.someValue\n        }\n      }\n    }\n  }\n}\n")),(0,r.kt)("p",null,"\u53ef\u4ee5\u53d8\u6210\u8fd9\u6837\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"function reducerWithImmer(state, action) {\n  state.first.second[action.someId].fourth = action.someValue\n}\n")),(0,r.kt)("p",null,"\u53d8\u5f97\u975e\u5e38\u6613\u8bfb\uff01"),(0,r.kt)("p",null,"\u4f46\uff0c\u8fd8\u6709\u4e00\u4e9b\u975e\u5e38\u91cd\u8981\u7684\u89c4\u5219\u8981\u8bb0\u4f4f\uff1a"),(0,r.kt)("blockquote",null,(0,r.kt)("h5",{parentName:"blockquote",id:"\u8b66\u544a"},"\u8b66\u544a"),(0,r.kt)("p",{parentName:"blockquote"},(0,r.kt)("strong",{parentName:"p"},"\u4f60\u53ea\u80fd\u5728 Redux Toolkit \u7684 ",(0,r.kt)("inlineCode",{parentName:"strong"},"createSlice")," \u548c ",(0,r.kt)("inlineCode",{parentName:"strong"},"createReducer")," \u4e2d\u7f16\u5199 \u201cmutation\u201d \u903b\u8f91\uff0c\u56e0\u4e3a\u5b83\u4eec\u5728\u5185\u90e8\u4f7f\u7528 Immer\uff01\u5982\u679c\u4f60\u5728\u6ca1\u6709 Immer \u7684 reducer \u4e2d\u7f16\u5199 mutation \u903b\u8f91\uff0c\u5b83\u5c06\u6539\u53d8\u72b6\u6001\u5e76\u5bfc\u81f4\u9519\u8bef\uff01"))),(0,r.kt)("h2",{id:"5\u4f20\u9012\u53c2\u6570"},"5.\u4f20\u9012\u53c2\u6570"),(0,r.kt)("p",null,"\u4e0a\u9762\u7684\u9879\u76ee\u4e2d\u56fa\u5b9a\u7684\u52a0\u4e00\u51cf\u4e00\uff0c\u90a3\u5982\u679c\u6211\u4eec\u60f3\u52a0\u591a\u5c11\u5c31\u80fd\u52a8\u6001\u52a0\u591a\u5c11\uff0c\u90a3\u5c31\u9700\u8981\u4f20\u53c2\u3002\u90a3\u5982\u4f55\u4f20\u53c2\u5462\uff1f"),(0,r.kt)("h3",{id:"51-\u5b9a\u4e49\u63a5\u53d7\u53c2\u6570"},"5.1 \u5b9a\u4e49\u63a5\u53d7\u53c2\u6570"),(0,r.kt)("p",null,"\u63a5\u6536\u53c2\u6570\u7684\u65b9\u5f0f\u548c ",(0,r.kt)("strong",{parentName:"p"},"redux")," \u4e00\u6837\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 action \u6765\u63a5\u6536\u53c2\u6570\uff0c\u5982\u4e0b\uff1a"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"store/features/counterSlice.js")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"import { createSlice } from '@reduxjs/toolkit'\n\n// \u521b\u5efa\u4e00\u4e2aSlice\nexport const counterSlice = createSlice({\n  //  ...\n  reducers: {\n    incrementByAmount: (state, action) => {\n      // action \u91cc\u9762\u6709 type \u548c payload \u4e24\u4e2a\u5c5e\u6027\uff0c\u6240\u6709\u7684\u4f20\u53c2\u90fd\u5728payload\u91cc\u9762\n      console.log(action)\n      state.value += action.payload\n    },\n  },\n})\n\n// \u5bfc\u51fa\u52a0\u51cf\u65b9\u6cd5\nexport const { increment, decrement, incrementByAmount } = counterSlice.actions\n\n// \u66b4\u9732reducer\nexport default counterSlice.reducer\n")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"incrementByAmount"),"\u7684",(0,r.kt)("inlineCode",{parentName:"p"},"action"),"\u53c2\u6570"),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://i0.hdslb.com/bfs/album/8922872833364c0a58fce00b9f48b1673497c582.png",alt:"image-20221031135743580"})),(0,r.kt)("h3",{id:"52-\u4f20\u9012\u53c2\u6570"},"5.2 \u4f20\u9012\u53c2\u6570"),(0,r.kt)("p",null,"\u548c ",(0,r.kt)("strong",{parentName:"p"},"redux")," \u7684\u4f20\u53c2\u4e00\u6837\uff0c\u5982\u4e0b\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-jsx"},"import React, { useState } from 'react'\nimport { useDispatch, useSelector } from 'react-redux'\n// \u5f15\u5165\u5bf9\u5e94\u7684\u65b9\u6cd5\nimport { incrementByAmount } from './store/features/counterSlice'\n\nexport default function App() {\n  const count = useSelector(state => state.counter.value)\n  const dispatch = useDispatch()\n  const [amount, setAmount] = useState(1)\n\n  return (\n    <div style={{ width: 500, margin: '100px auto' }}>\n      <input type=\"text\" value={amount} onChange={e => setAmount(e.target.value)} />\n      <button onClick={() => dispatch(incrementByAmount(Number(amount) || 0))}> Add Amount </button>\n      <span>{count}</span>\n    </div>\n  )\n}\n")),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://i0.hdslb.com/bfs/album/0532fd6d2997236a9cd9785fbb4c570ca14294cd.png",alt:"image-20221031135809294"})),(0,r.kt)("p",null,"\u6ce8\u610f\u8fd9\u91ccreducer\u7684action\u4e2d\u5982\u679c\u8981\u4f20\u5165\u53c2\u6570\uff0c\u53ea\u80fd\u662f\u4e00\u4e2apayload\uff0c\u5982\u679c\u662f\u591a\u4e2a\u53c2\u6570\u7684\u60c5\u51b5\uff0c\u90a3\u5c31\u9700\u8981\u5c01\u88c5\u6210\u4e00\u4e2apayload\u7684\u5bf9\u8c61\u3002"),(0,r.kt)("h3",{id:"53-action-payloads"},"5.3 Action Payloads"),(0,r.kt)("p",null,"\u4ee5\u4e00\u4e2a\u5e38\u89c1\u7684todo\u6848\u4f8b\u6765\u8bb2\u89e3"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"store/features/todoSlice.js")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"import { createSlice, nanoid } from '@reduxjs/toolkit'\n\nconst initialState = {\n  todoList: [],\n}\n\n// \u521b\u5efa\u4e00\u4e2aSlice\nexport const todoSlice = createSlice({\n  name: 'todo',\n  initialState,\n  reducers: {\n    addTodo: (state, action) => {}\n    },\n  },\n})\n\n// \u5bfc\u51fa\u52a0\u51cf\u65b9\u6cd5\nexport const { addTodo } = todoSlice.actions\n\n// \u66b4\u9732reducer\nexport default todoSlice.reducer\n")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"store/index.js")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"import { configureStore } from '@reduxjs/toolkit'\nimport counterSlice from './features/counterSlice'\nimport todoSlice from './features/todoSlice'\n\n// configureStore\u521b\u5efa\u4e00\u4e2aredux\u6570\u636e\nconst store = configureStore({\n  // \u5408\u5e76\u591a\u4e2aSlice\n  reducer: {\n    counter: counterSlice,\n    todo: todoSlice,\n  },\n})\n\nexport default store\n")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"Todo.jsx")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-jsx"},"import React from 'react'\nimport { useDispatch, useSelector } from 'react-redux'\n// \u5f15\u5165\u5bf9\u5e94\u7684\u65b9\u6cd5\nimport { addTodo } from '../store/features/todoSlice'\n\nexport default function Todo() {\n  const todoList = useSelector(state => state.todo.todoList)\n\n  const dispatch = useDispatch()\n\n  return (\n    <div>\n      <p>\u4efb\u52a1\u5217\u8868</p>\n      <ul>\n        {todoList.map(todo => (\n          <li key={todo.id}>\n            <input type=\"checkbox\" defaultChecked={todo.completed} /> {todo.content}\n          </li>\n        ))}\n      </ul>\n      <button onClick={() => dispatch(addTodo('\u6572\u4ee3\u7801'))}>\u589e\u52a0\u4e00\u4e2atodo</button>\n    </div>\n  )\n}\n")),(0,r.kt)("p",null,"\u6211\u4eec\u521a\u521a\u770b\u5230 ",(0,r.kt)("inlineCode",{parentName:"p"},"createSlice")," \u4e2d\u7684 action creator \u901a\u5e38\u671f\u671b\u4e00\u4e2a\u53c2\u6570\uff0c\u5b83\u53d8\u6210\u4e86 ",(0,r.kt)("inlineCode",{parentName:"p"},"action.payload"),"\u3002\u8fd9\u7b80\u5316\u4e86\u6700\u5e38\u89c1\u7684\u4f7f\u7528\u6a21\u5f0f\uff0c\u4f46\u6709\u65f6\u6211\u4eec\u9700\u8981\u505a\u66f4\u591a\u7684\u5de5\u4f5c\u6765\u51c6\u5907 action \u5bf9\u8c61\u7684\u5185\u5bb9\u3002 \u5728\u6211\u4eec\u7684 ",(0,r.kt)("inlineCode",{parentName:"p"},"postAdded")," \u64cd\u4f5c\u7684\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u9700\u8981\u4e3a\u65b0todo\u751f\u6210\u4e00\u4e2a\u552f\u4e00\u7684 ID\uff0c\u6211\u4eec\u8fd8\u9700\u8981\u786e\u4fdd\u6709\u6548 payload \u662f\u4e00\u4e2a\u770b\u8d77\u6765\u50cf ",(0,r.kt)("inlineCode",{parentName:"p"},"{id, content, completed}")," \u7684\u5bf9\u8c61\u3002"),(0,r.kt)("p",null,"\u73b0\u5728\uff0c\u6211\u4eec\u6b63\u5728 React \u7ec4\u4ef6\u4e2d\u751f\u6210 ID \u5e76\u521b\u5efa\u6709\u6548 payload \u5bf9\u8c61\uff0c\u5e76\u5c06\u6709\u6548 payload \u5bf9\u8c61\u4f20\u9012\u7ed9 ",(0,r.kt)("inlineCode",{parentName:"p"},"addTodo"),"\u3002 \u4f46\u662f\uff0c\u5982\u679c\u6211\u4eec\u9700\u8981\u4ece\u4e0d\u540c\u7684\u7ec4\u4ef6 dispatch \u76f8\u540c\u7684 action\uff0c\u6216\u8005\u51c6\u5907 payload \u7684\u903b\u8f91\u5f88\u590d\u6742\u600e\u4e48\u529e\uff1f \u6bcf\u6b21\u6211\u4eec\u60f3\u8981 dispatch action \u65f6\uff0c\u6211\u4eec\u90fd\u5fc5\u987b\u590d\u5236\u8be5\u903b\u8f91\uff0c\u5e76\u4e14\u6211\u4eec\u5f3a\u5236\u7ec4\u4ef6\u786e\u5207\u5730\u77e5\u9053\u6b64 action \u7684\u6709\u6548 payload \u5e94\u8be5\u662f\u4ec0\u4e48\u6837\u5b50\u3002"),(0,r.kt)("blockquote",null,(0,r.kt)("h5",{parentName:"blockquote",id:"\u6ce8\u610f"},"\u6ce8\u610f"),(0,r.kt)("p",{parentName:"blockquote"},"\u5982\u679c action \u9700\u8981\u5305\u542b\u552f\u4e00 ID \u6216\u5176\u4ed6\u4e00\u4e9b\u968f\u673a\u503c\uff0c\u8bf7\u59cb\u7ec8\u5148\u751f\u6210\u8be5\u968f\u673a\u503c\u5e76\u5c06\u5176\u653e\u5165 action \u5bf9\u8c61\u4e2d\u3002 ",(0,r.kt)("strong",{parentName:"p"},"Reducer \u4e2d\u6c38\u8fdc\u4e0d\u5e94\u8be5\u8ba1\u7b97\u968f\u673a\u503c"),"\uff0c\u56e0\u4e3a\u8fd9\u4f1a\u4f7f\u7ed3\u679c\u4e0d\u53ef\u9884\u6d4b\u3002")),(0,r.kt)("p",null,"\u5e78\u8fd0\u7684\u662f\uff0c",(0,r.kt)("inlineCode",{parentName:"p"},"createSlice")," \u5141\u8bb8\u6211\u4eec\u5728\u7f16\u5199 reducer \u65f6\u5b9a\u4e49\u4e00\u4e2a ",(0,r.kt)("inlineCode",{parentName:"p"},"prepare")," \u51fd\u6570\u3002 ",(0,r.kt)("inlineCode",{parentName:"p"},"prepare")," \u51fd\u6570\u53ef\u4ee5\u63a5\u53d7\u591a\u4e2a\u53c2\u6570\uff0c\u751f\u6210\u8bf8\u5982\u552f\u4e00 ID \u4e4b\u7c7b\u7684\u968f\u673a\u503c\uff0c\u5e76\u8fd0\u884c\u9700\u8981\u7684\u4efb\u4f55\u5176\u4ed6\u540c\u6b65\u903b\u8f91\u6765\u51b3\u5b9a\u54ea\u4e9b\u503c\u8fdb\u5165 action \u5bf9\u8c61\u3002\u7136\u540e\u5b83\u5e94\u8be5\u8fd4\u56de\u4e00\u4e2a\u5305\u542b ",(0,r.kt)("inlineCode",{parentName:"p"},"payload")," \u5b57\u6bb5\u7684\u5bf9\u8c61\u3002\uff08\u8fd4\u56de\u5bf9\u8c61\u8fd8\u53ef\u80fd\u5305\u542b\u4e00\u4e2a ",(0,r.kt)("inlineCode",{parentName:"p"},"meta")," \u5b57\u6bb5\uff0c\u53ef\u7528\u4e8e\u5411 action \u6dfb\u52a0\u989d\u5916\u7684\u63cf\u8ff0\u6027\u503c\uff0c\u4ee5\u53ca\u4e00\u4e2a ",(0,r.kt)("inlineCode",{parentName:"p"},"error")," \u5b57\u6bb5\uff0c\u8be5\u5b57\u6bb5\u5e94\u8be5\u662f\u4e00\u4e2a\u5e03\u5c14\u503c\uff0c\u6307\u793a\u6b64 action \u662f\u5426\u8868\u793a\u67d0\u79cd\u9519\u8bef\u3002\uff09"),(0,r.kt)("p",null," rtk\u8fd8\u63d0\u4f9b\u4e86\u4e00\u4e2ananoid\u65b9\u6cd5\uff0c\u7528\u4e8e\u751f\u6210\u4e00\u4e2a\u56fa\u5b9a\u957f\u5ea6\u7684\u968f\u673a\u5b57\u7b26\u4e32\uff0c\u7c7b\u4f3cuuid\u529f\u80fd\u3002"),(0,r.kt)("p",null,"\u53ef\u4ee5\u6253\u5370",(0,r.kt)("inlineCode",{parentName:"p"},"dispatch(addTodo(\u2019\u6572\u4ee3\u7801\u2018))"),"\u7684\u7ed3\u679c\u770b\u5230\uff0c\u8fd4\u56de\u4e86\u4e00\u4e2a\u5e26\u6709payload\u5b57\u6bb5\u7684action"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"import { createSlice, nanoid } from '@reduxjs/toolkit'\n\n// \u521b\u5efa\u4e00\u4e2aSlice\nexport const todoSlice = createSlice({\n  name: 'todo',\n  initialState,\n  reducers: {\n    addTodo: {\n      // \u8fd9\u4e2a\u51fd\u6570\u5c31\u662f\u6211\u4eec\u5e73\u65f6\u76f4\u63a5\u5199\u5728\u8fd9\u7684\u51fd\u6570\uff08 addTodo: (state, action) => {}\uff09\n      reducer(state, aciton) {\n        console.log('addTodo-reducer\u6267\u884c')\n        const { id, content } = aciton.payload\n        state.todoList.push({ id, content, completed: false })\n      },\n       // \u9884\u5904\u7406\u51fd\u6570\uff0c\u8fd4\u56de\u503c\u5c31\u662freducer\u51fd\u6570\u63a5\u6536\u7684pyload\u503c, \u5fc5\u987b\u8fd4\u56de\u4e00\u4e2a\u5e26\u6709payload\u5b57\u6bb5\u7684\u5bf9\u8c61\n      prepare(content) {\n        console.log('prepare\u53c2\u6570', content)\n        return {\n          payload: {\n            id: nanoid(),\n            content,\n          },\n        }\n      },\n    },\n  },\n})\n")),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://i0.hdslb.com/bfs/album/14de82a82d9aafe1d596aba45868e51ea1aca5e6.png",alt:"image-20221031151023678"})),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://i0.hdslb.com/bfs/album/1ff5eeaa69ef4cc93cce72f5b48f0650c02929e5.png",alt:"image-20221031151138719"})),(0,r.kt)("h2",{id:"6\u5f02\u6b65\u903b\u8f91\u4e0e\u6570\u636e\u8bf7\u6c42"},"6.\u5f02\u6b65\u903b\u8f91\u4e0e\u6570\u636e\u8bf7\u6c42"),(0,r.kt)("h3",{id:"61-thunks-\u4e0e\u5f02\u6b65\u903b\u8f91"},"6.1 Thunks \u4e0e\u5f02\u6b65\u903b\u8f91"),(0,r.kt)("p",null,"\u5c31\u5176\u672c\u8eab\u800c\u8a00\uff0cRedux store \u5bf9\u5f02\u6b65\u903b\u8f91\u4e00\u65e0\u6240\u77e5\u3002\u5b83\u53ea\u77e5\u9053\u5982\u4f55\u540c\u6b65 dispatch action\uff0c\u901a\u8fc7\u8c03\u7528 root reducer \u51fd\u6570\u66f4\u65b0\u72b6\u6001\uff0c\u5e76\u901a\u77e5 UI \u67d0\u4e9b\u4e8b\u60c5\u53d1\u751f\u4e86\u53d8\u5316\u3002\u4efb\u4f55\u5f02\u6b65\u90fd\u5fc5\u987b\u53d1\u751f\u5728 store \u4e4b\u5916\u3002"),(0,r.kt)("p",null,"\u4f46\u662f\uff0c\u5982\u679c\u4f60\u5e0c\u671b\u901a\u8fc7\u8c03\u5ea6\u6216\u68c0\u67e5\u5f53\u524d store \u72b6\u6001\u6765\u4f7f\u5f02\u6b65\u903b\u8f91\u4e0e store \u4ea4\u4e92\uff0c\u8be5\u600e\u4e48\u529e\uff1f \u8fd9\u5c31\u662f ",(0,r.kt)("a",{parentName:"p",href:"https://cn.redux.js.org/tutorials/fundamentals/part-4-store#middleware"},"Redux middleware")," \u7684\u7528\u6b66\u4e4b\u5730\u3002\u5b83\u4eec\u6269\u5c55\u4e86 store\uff0c\u5e76\u5141\u8bb8\u4f60\uff1a"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"dispatch action \u65f6\u6267\u884c\u989d\u5916\u7684\u903b\u8f91\uff08\u4f8b\u5982\u6253\u5370 action \u7684\u65e5\u5fd7\u548c\u72b6\u6001\uff09"),(0,r.kt)("li",{parentName:"ul"},"\u6682\u505c\u3001\u4fee\u6539\u3001\u5ef6\u8fdf\u3001\u66ff\u6362\u6216\u505c\u6b62 dispatch \u7684 action"),(0,r.kt)("li",{parentName:"ul"},"\u7f16\u5199\u53ef\u4ee5\u8bbf\u95ee ",(0,r.kt)("inlineCode",{parentName:"li"},"dispatch")," \u548c ",(0,r.kt)("inlineCode",{parentName:"li"},"getState")," \u7684\u989d\u5916\u4ee3\u7801"),(0,r.kt)("li",{parentName:"ul"},"\u6559 ",(0,r.kt)("inlineCode",{parentName:"li"},"dispatch")," \u5982\u4f55\u63a5\u53d7\u9664\u666e\u901a action \u5bf9\u8c61\u4e4b\u5916\u7684\u5176\u4ed6\u503c\uff0c\u4f8b\u5982\u51fd\u6570\u548c promise\uff0c\u901a\u8fc7\u62e6\u622a\u5b83\u4eec\u5e76 dispatch \u5b9e\u9645 action \u5bf9\u8c61\u6765\u4ee3\u66ff")),(0,r.kt)("p",null,"Redux \u6709\u591a\u79cd\u5f02\u6b65 middleware\uff0c\u6bcf\u4e00\u79cd\u90fd\u5141\u8bb8\u4f60\u4f7f\u7528\u4e0d\u540c\u7684\u8bed\u6cd5\u7f16\u5199\u903b\u8f91\u3002\u6700\u5e38\u89c1\u7684\u5f02\u6b65 middleware \u662f ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/reduxjs/redux-thunk"},(0,r.kt)("inlineCode",{parentName:"a"},"redux-thunk")),"\uff0c\u5b83\u53ef\u4ee5\u8ba9\u4f60\u7f16\u5199\u53ef\u80fd\u76f4\u63a5\u5305\u542b\u5f02\u6b65\u903b\u8f91\u7684\u666e\u901a\u51fd\u6570\u3002Redux Toolkit \u7684 ",(0,r.kt)("inlineCode",{parentName:"p"},"configureStore")," \u529f\u80fd",(0,r.kt)("a",{parentName:"p",href:"https://redux-toolkit.js.org/api/getDefaultMiddleware#included-default-middleware"},"\u9ed8\u8ba4\u81ea\u52a8\u8bbe\u7f6e thunk middleware"),"\uff0c",(0,r.kt)("a",{parentName:"p",href:"https://cn.redux.js.org/style-guide/#use-thunks-for-async-logic"},"\u6211\u4eec\u63a8\u8350\u4f7f\u7528 thunk \u4f5c\u4e3a Redux \u5f00\u53d1\u5f02\u6b65\u903b\u8f91\u7684\u6807\u51c6\u65b9\u5f0f"),"\u3002"),(0,r.kt)("h3",{id:"62-thunk-\u51fd\u6570"},"6.2 Thunk \u51fd\u6570"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"thunk"),"\u6700\u91cd\u8981\u7684\u601d\u60f3\uff0c\u5c31\u662f\u53ef\u4ee5\u63a5\u53d7\u4e00\u4e2a\u8fd4\u56de\u51fd\u6570\u7684",(0,r.kt)("inlineCode",{parentName:"p"},"action creator"),"\u3002\u5982\u679c\u8fd9\u4e2a",(0,r.kt)("inlineCode",{parentName:"p"},"action creator")," \u8fd4\u56de\u7684\u662f\u4e00\u4e2a\u51fd\u6570\uff0c\u5c31\u6267\u884c\u5b83\uff0c\u5982\u679c\u4e0d\u662f\uff0c\u5c31\u6309\u7167\u539f\u6765\u7684",(0,r.kt)("inlineCode",{parentName:"p"},"action"),"\u6267\u884c\u3002"),(0,r.kt)("p",null,"\u6b63\u56e0\u4e3a\u8fd9\u4e2aaction creator\u53ef\u4ee5\u8fd4\u56de\u4e00\u4e2a\u51fd\u6570\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u5728\u8fd9\u4e2a\u51fd\u6570\u4e2d\u6267\u884c\u4e00\u4e9b\u5f02\u6b65\u7684\u64cd\u4f5c\u3002"),(0,r.kt)("p",null,"Thunks \u901a\u5e38\u8fd8\u53ef\u4ee5\u4f7f\u7528 action creator \u518d\u6b21 dispatch \u666e\u901a\u7684 action\uff0c\u6bd4\u5982 ",(0,r.kt)("inlineCode",{parentName:"p"},"dispatch(increment())")),(0,r.kt)("p",null,"\u4e3a\u4e86\u4e0e dispatch \u666e\u901a action \u5bf9\u8c61\u4fdd\u6301\u4e00\u81f4\uff0c\u6211\u4eec\u901a\u5e38\u5c06\u5b83\u4eec\u5199\u4e3a ",(0,r.kt)("em",{parentName:"p"},"thunk action creators"),"\uff0c\u5b83\u8fd4\u56de thunk \u51fd\u6570\u3002\u8fd9\u4e9b action creator \u53ef\u4ee5\u63a5\u53d7\u53ef\u4ee5\u5728 thunk \u4e2d\u4f7f\u7528\u7684\u53c2\u6570\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"const incrementAsync = amount => {\n  return (dispatch, getState) => {\n    setTimeout(() => {\n      dispatch(incrementByAmount(amount))\n    }, 1000)\n  }\n}\n")),(0,r.kt)("p",null,"incrementAsync\u51fd\u6570\u5c31\u8fd4\u56de\u4e86\u4e00\u4e2a\u51fd\u6570\uff0c\u5c06dispatch\u4f5c\u4e3a\u51fd\u6570\u7684\u7b2c\u4e00\u4e2a\u53c2\u6570\u4f20\u9012\u8fdb\u53bb\uff0c\u5728\u51fd\u6570\u5185\u8fdb\u884c\u5f02\u6b65\u64cd\u4f5c\u5c31\u53ef\u4ee5\u4e86\u3002"),(0,r.kt)("p",null,"Thunk \u901a\u5e38\u5199\u5728 \u201cslice\u201d \u6587\u4ef6\u4e2d\u3002",(0,r.kt)("inlineCode",{parentName:"p"},"createSlice")," \u672c\u8eab\u5bf9\u5b9a\u4e49 thunk \u6ca1\u6709\u4efb\u4f55\u7279\u6b8a\u652f\u6301\uff0c\u56e0\u6b64\u4f60\u5e94\u8be5\u5c06\u5b83\u4eec\u4f5c\u4e3a\u5355\u72ec\u7684\u51fd\u6570\u7f16\u5199\u5728\u540c\u4e00\u4e2a slice \u6587\u4ef6\u4e2d\u3002\u8fd9\u6837\uff0c\u4ed6\u4eec\u5c31\u53ef\u4ee5\u8bbf\u95ee\u8be5 slice \u7684\u666e\u901a action creator\uff0c\u5e76\u4e14\u5f88\u5bb9\u6613\u627e\u5230 thunk \u7684\u4f4d\u7f6e\u3002"),(0,r.kt)("h3",{id:"63-\u6539\u5199\u4e4b\u524d\u7684\u8ba1\u6570\u5668\u6848\u4f8b"},"6.3 \u6539\u5199\u4e4b\u524d\u7684\u8ba1\u6570\u5668\u6848\u4f8b"),(0,r.kt)("p",null,"\u589e\u52a0\u4e00\u4e2a\u5ef6\u65f6\u5668"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"store/features/counterSlice.js")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"import { createSlice } from '@reduxjs/toolkit'\n\nconst initialState = {\n  value: 0,\n}\n\n// \u521b\u5efa\u4e00\u4e2aSlice\nexport const counterSlice = createSlice({\n  name: 'counter',\n  initialState,\n  reducers: {\n    incrementByAmount: (state, action) => {\n      // action \u91cc\u9762\u6709 type \u548c payload \u4e24\u4e2a\u5c5e\u6027\uff0c\u6240\u6709\u7684\u4f20\u53c2\u90fd\u5728payload\u91cc\u9762\n      state.value += action.payload\n    },\n  },\n})\n\nconst {incrementByAmount } = counterSlice.actions\n\nexport const incrementAsync = amount => {\n  return (dispatch, getState) => {\n      \n    const stateBefore = getState()\n    console.log('Counter before:', stateBefore.counter)\n      \n    setTimeout(() => {\n      dispatch(incrementByAmount(amount))\n      const stateAfter = getState()\n      console.log('Counter after:', stateAfter.counter)\n    }, 1000)\n  }\n}\n\n// \u66b4\u9732reducer\nexport default counterSlice.reducer\n")),(0,r.kt)("p",null,"`",(0,r.kt)("inlineCode",{parentName:"p"},"App.jsx")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-jsx"},"import React, { useState } from 'react'\nimport { useDispatch, useSelector } from 'react-redux'\n// \u5f15\u5165\u5bf9\u5e94\u7684\u65b9\u6cd5\nimport { incrementAsync } from './store/features/counterSlice'\n\nexport default function App() {\n  const count = useSelector(state => state.counter.value)\n  const dispatch = useDispatch()\n  const [amount, setAmount] = useState(1)\n\n  return (\n    <div style={{ width: 500, margin: '100px auto' }}>\n      <input type=\"text\" value={amount} onChange={e => setAmount(e.target.value)} />\n      <button onClick={() => dispatch(incrementAsync(Number(amount) || 0))}> Add Async </button>\n      <span>{count}</span>\n    </div>\n  )\n}\n")),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://i0.hdslb.com/bfs/album/0d1821f7e40c5806f0de11044594080898978abb.png",alt:"image-20221031171739218"})),(0,r.kt)("h3",{id:"64-\u7f16\u5199\u5f02\u6b65-thunks"},"6.4 \u7f16\u5199\u5f02\u6b65 Thunks"),(0,r.kt)("p",null,"Thunk \u5185\u90e8\u53ef\u80fd\u6709\u5f02\u6b65\u903b\u8f91\uff0c\u4f8b\u5982 ",(0,r.kt)("inlineCode",{parentName:"p"},"setTimeout"),"\u3001",(0,r.kt)("inlineCode",{parentName:"p"},"Promise")," \u548c ",(0,r.kt)("inlineCode",{parentName:"p"},"async/await"),"\u3002\u8fd9\u4f7f\u5b83\u4eec\u6210\u4e3a\u4f7f\u7528 AJAX \u53d1\u8d77 API \u8bf7\u6c42\u7684\u597d\u5730\u65b9\u3002"),(0,r.kt)("p",null,"Redux \u7684\u6570\u636e\u8bf7\u6c42\u903b\u8f91\u901a\u5e38\u9075\u5faa\u4ee5\u4e0b\u53ef\u9884\u6d4b\u7684\u6a21\u5f0f\uff1a"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u5728\u8bf7\u6c42\u4e4b\u524d dispatch \u8bf7\u6c42\u201c\u5f00\u59cb\u201d\u7684 action\uff0c\u4ee5\u6307\u793a\u8bf7\u6c42\u6b63\u5728\u8fdb\u884c\u4e2d\u3002\u8fd9\u53ef\u7528\u4e8e\u8ddf\u8e2a\u52a0\u8f7d\u72b6\u6001\u4ee5\u5141\u8bb8\u8df3\u8fc7\u91cd\u590d\u8bf7\u6c42\u6216\u5728 UI \u4e2d\u663e\u793a\u52a0\u8f7d\u4e2d\u63d0\u793a\u3002"),(0,r.kt)("li",{parentName:"ul"},"\u53d1\u51fa\u5f02\u6b65\u8bf7\u6c42"),(0,r.kt)("li",{parentName:"ul"},"\u6839\u636e\u8bf7\u6c42\u7ed3\u679c\uff0c\u5f02\u6b65\u903b\u8f91 dispatch \u5305\u542b\u7ed3\u679c\u6570\u636e\u7684\u201c\u6210\u529f\u201d action \u6216\u5305\u542b\u9519\u8bef\u8be6\u7ec6\u4fe1\u606f\u7684 \u201c\u5931\u8d25\u201d action\u3002\u5728\u8fd9\u4e24\u79cd\u60c5\u51b5\u4e0b\uff0creducer \u903b\u8f91\u90fd\u4f1a\u6e05\u9664\u52a0\u8f7d\u72b6\u6001\uff0c\u5e76\u4e14\u8981\u4e48\u5c55\u793a\u6210\u529f\u6848\u4f8b\u7684\u7ed3\u679c\u6570\u636e\uff0c\u8981\u4e48\u4fdd\u5b58\u9519\u8bef\u503c\u5e76\u5728\u9700\u8981\u7684\u5730\u65b9\u5c55\u793a\u3002")),(0,r.kt)("p",null,"\u8fd9\u4e9b\u6b65\u9aa4\u4e0d\u662f ",(0,r.kt)("em",{parentName:"p"},"\u5fc5\u9700\u7684"),"\uff0c\u800c\u662f\u5e38\u7528\u7684\u3002\uff08\u5982\u679c\u4f60\u53ea\u5173\u5fc3\u4e00\u4e2a\u6210\u529f\u7684\u7ed3\u679c\uff0c\u4f60\u53ef\u4ee5\u5728\u8bf7\u6c42\u5b8c\u6210\u65f6\u53d1\u9001\u4e00\u4e2a\u201c\u6210\u529f\u201d action \uff0c\u5e76\u8df3\u8fc7\u201c\u5f00\u59cb\u201d\u548c\u201c\u5931\u8d25\u201d action \u3002\uff09"),(0,r.kt)("p",null,"Redux Toolkit \u63d0\u4f9b\u4e86\u4e00\u4e2a ",(0,r.kt)("inlineCode",{parentName:"p"},"createAsyncThunk")," API \u6765\u5b9e\u73b0\u8fd9\u4e9b action \u7684\u521b\u5efa\u548c dispatch\uff0c\u6211\u4eec\u5f88\u5feb\u5c31\u4f1a\u770b\u770b\u5982\u4f55\u4f7f\u7528\u5b83\u3002"),(0,r.kt)("p",null,"\u5982\u679c\u6211\u4eec\u624b\u52a8\u7f16\u5199\u4e00\u4e2a\u5178\u578b\u7684 async thunk \u7684\u4ee3\u7801\uff0c\u5b83\u53ef\u80fd\u770b\u8d77\u6765\u50cf\u8fd9\u6837\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"const getRepoDetailsStarted = () => ({\n  type: 'repoDetails/fetchStarted'\n})\nconst getRepoDetailsSuccess = repoDetails => ({\n  type: 'repoDetails/fetchSucceeded',\n  payload: repoDetails\n})\nconst getRepoDetailsFailed = error => ({\n  type: 'repoDetails/fetchFailed',\n  error\n})\nconst fetchIssuesCount = (org, repo) => async dispatch => {\n  dispatch(getRepoDetailsStarted())\n  try {\n    const repoDetails = await getRepoDetails(org, repo)\n    dispatch(getRepoDetailsSuccess(repoDetails))\n  } catch (err) {\n    dispatch(getRepoDetailsFailed(err.toString()))\n  }\n}\n")),(0,r.kt)("p",null,"\u4f46\u662f\uff0c\u4f7f\u7528\u8fd9\u79cd\u65b9\u6cd5\u7f16\u5199\u4ee3\u7801\u5f88\u4e4f\u5473\u3002\u6bcf\u4e2a\u5355\u72ec\u7684\u8bf7\u6c42\u7c7b\u578b\u90fd\u9700\u8981\u91cd\u590d\u7c7b\u4f3c\u7684\u5b9e\u73b0\uff1a"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u9700\u8981\u4e3a\u4e09\u79cd\u4e0d\u540c\u7684\u60c5\u51b5\u5b9a\u4e49\u72ec\u7279\u7684 action \u7c7b\u578b"),(0,r.kt)("li",{parentName:"ul"},"\u6bcf\u79cd action \u7c7b\u578b\u901a\u5e38\u90fd\u6709\u76f8\u5e94\u7684 action creator \u529f\u80fd"),(0,r.kt)("li",{parentName:"ul"},"\u5fc5\u987b\u7f16\u5199\u4e00\u4e2a thunk \u4ee5\u6b63\u786e\u7684\u987a\u5e8f\u53d1\u9001\u6b63\u786e\u7684 action")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"createAsyncThunk")," \u5b9e\u73b0\u4e86\u8fd9\u5957\u6a21\u5f0f\uff1a\u901a\u8fc7\u751f\u6210 action type \u548c action creator \u5e76\u751f\u6210\u4e00\u4e2a\u81ea\u52a8 dispatch \u8fd9\u4e9b action \u7684 thunk\u3002\u4f60\u63d0\u4f9b\u4e00\u4e2a\u56de\u8c03\u51fd\u6570\u6765\u8fdb\u884c\u5f02\u6b65\u8c03\u7528\uff0c\u5e76\u628a\u7ed3\u679c\u6570\u636e\u8fd4\u56de\u6210 Promise\u3002"),(0,r.kt)("h3",{id:"65-\u4f7f\u7528-createasyncthunk-\u8bf7\u6c42\u6570\u636e"},"6.5 \u4f7f\u7528 createAsyncThunk \u8bf7\u6c42\u6570\u636e"),(0,r.kt)("p",null,"Redux Toolkit \u7684 ",(0,r.kt)("inlineCode",{parentName:"p"},"createAsyncThunk"),' API \u751f\u6210 thunk\uff0c\u4e3a\u4f60\u81ea\u52a8 dispatch \u90a3\u4e9b "start/success/failure" action\u3002'),(0,r.kt)("p",null,"\u8ba9\u6211\u4eec\u4ece\u6dfb\u52a0\u4e00\u4e2a thunk \u5f00\u59cb\uff0c\u8be5 thunk \u5c06\u8fdb\u884c AJAX \u8c03\u7528\u3002"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"store/features/counterSlice.js")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-jsx"},"import { createSlice, createAsyncThunk } from '@reduxjs/toolkit'\n\n// \u8bf7\u6c42\u7535\u5f71\u5217\u8868\nconst reqMovieListApi = () =>\n  fetch(\n    'https://pcw-api.iqiyi.com/search/recommend/list?channel_id=1&data_type=1&mode=24&page_id=1&ret_num=48',\n  ).then(res => res.json())\n\nconst initialState = {\n  status: 'idel',\n  list: [],\n  totals: 0,\n}\n\n// thunk\u51fd\u6570\u5141\u8bb8\u6267\u884c\u5f02\u6b65\u903b\u8f91, \u901a\u5e38\u7528\u4e8e\u53d1\u51fa\u5f02\u6b65\u8bf7\u6c42\u3002\n// createAsyncThunk \u521b\u5efa\u4e00\u4e2a\u5f02\u6b65action\uff0c\u65b9\u6cd5\u89e6\u53d1\u7684\u65f6\u5019\u4f1a\u6709\u4e09\u79cd\u72b6\u6001\uff1a\n// pending\uff08\u8fdb\u884c\u4e2d\uff09\u3001fulfilled\uff08\u6210\u529f\uff09\u3001rejected\uff08\u5931\u8d25\uff09\nexport const getMovieData = createAsyncThunk('movie/getMovie', async () => {\n  const res = await reqMovieListApi()\n  return res.data\n})\n")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"createAsyncThunk")," \u63a5\u6536 2 \u4e2a\u53c2\u6570:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u5c06\u7528\u4f5c\u751f\u6210\u7684 action \u7c7b\u578b\u7684\u524d\u7f00\u7684\u5b57\u7b26\u4e32"),(0,r.kt)("li",{parentName:"ul"},"\u4e00\u4e2a \u201cpayload creator\u201d \u56de\u8c03\u51fd\u6570\uff0c\u5b83\u5e94\u8be5\u8fd4\u56de\u4e00\u4e2a\u5305\u542b\u4e00\u4e9b\u6570\u636e\u7684 ",(0,r.kt)("inlineCode",{parentName:"li"},"Promise"),"\uff0c\u6216\u8005\u4e00\u4e2a\u88ab\u62d2\u7edd\u7684\u5e26\u6709\u9519\u8bef\u7684 ",(0,r.kt)("inlineCode",{parentName:"li"},"Promise"))),(0,r.kt)("p",null,"Payload creator \u901a\u5e38\u4f1a\u8fdb\u884c\u67d0\u79cd AJAX \u8c03\u7528\uff0c\u5e76\u4e14\u53ef\u4ee5\u76f4\u63a5\u4ece AJAX \u8c03\u7528\u8fd4\u56de ",(0,r.kt)("inlineCode",{parentName:"p"},"Promise"),"\uff0c\u6216\u8005\u4ece API \u54cd\u5e94\u4e2d\u63d0\u53d6\u4e00\u4e9b\u6570\u636e\u5e76\u8fd4\u56de\u3002\u6211\u4eec\u901a\u5e38\u4f7f\u7528 JS ",(0,r.kt)("inlineCode",{parentName:"p"},"async/await")," \u8bed\u6cd5\u6765\u7f16\u5199\u5b83\uff0c\u8fd9\u8ba9\u6211\u4eec\u53ef\u4ee5\u7f16\u5199\u4f7f\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"Promise")," \u7684\u51fd\u6570\uff0c\u540c\u65f6\u4f7f\u7528\u6807\u51c6\u7684 ",(0,r.kt)("inlineCode",{parentName:"p"},"try/catch")," \u903b\u8f91\u800c\u4e0d\u662f ",(0,r.kt)("inlineCode",{parentName:"p"},"somePromise.then()")," \u94fe\u5f0f\u8c03\u7528\u3002"),(0,r.kt)("p",null,"\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u4f20\u5165 ",(0,r.kt)("inlineCode",{parentName:"p"},"'movie/getMovie'")," \u4f5c\u4e3a action \u7c7b\u578b\u7684\u524d\u7f00\u3002\u6211\u4eec\u7684 payload \u521b\u5efa\u56de\u8c03\u7b49\u5f85 API \u8c03\u7528\u8fd4\u56de\u54cd\u5e94\u3002\u54cd\u5e94\u5bf9\u8c61\u7684\u683c\u5f0f\u4e3a ",(0,r.kt)("inlineCode",{parentName:"p"},"{data: []}"),"\uff0c\u6211\u4eec\u5e0c\u671b\u6211\u4eec dispatch \u7684 Redux action \u6709\u4e00\u4e2a payload\uff0c\u4e5f\u5c31\u662f\u7535\u5f71\u5217\u8868\u7684\u6570\u7ec4\u3002\u6240\u4ee5\uff0c\u6211\u4eec\u63d0\u53d6 ",(0,r.kt)("inlineCode",{parentName:"p"},"response.data"),"\uff0c\u5e76\u4ece\u56de\u8c03\u4e2d\u8fd4\u56de\u5b83\u3002"),(0,r.kt)("p",null,"\u5f53\u8c03\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"dispatch(getMovieData())")," \u7684\u65f6\u5019\uff0c",(0,r.kt)("inlineCode",{parentName:"p"},"getMovieData")," \u8fd9\u4e2a thunk \u4f1a\u9996\u5148 dispatch \u4e00\u4e2a action \u7c7b\u578b\u4e3a",(0,r.kt)("inlineCode",{parentName:"p"},"'movie/getMovie/pending'"),"\uff1a"),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://i0.hdslb.com/bfs/album/9be6ef4c8ae21c2620a5e397d99cfe7f4d2865c2.png",alt:"image-20221031180756586"})),(0,r.kt)("p",null,"\u6211\u4eec\u53ef\u4ee5\u5728\u6211\u4eec\u7684 reducer \u4e2d\u76d1\u542c\u8fd9\u4e2a action \u5e76\u5c06\u8bf7\u6c42\u72b6\u6001\u6807\u8bb0\u4e3a \u201cloading \u6b63\u5728\u52a0\u8f7d\u201d\u3002"),(0,r.kt)("p",null,"\u4e00\u65e6 ",(0,r.kt)("inlineCode",{parentName:"p"},"Promise")," \u6210\u529f\uff0c",(0,r.kt)("inlineCode",{parentName:"p"},"getMovieData")," thunk \u4f1a\u63a5\u53d7\u6211\u4eec\u4ece\u56de\u8c03\u4e2d\u8fd4\u56de\u7684 ",(0,r.kt)("inlineCode",{parentName:"p"},"response.data")," \uff0c\u5e76 dispatch \u4e00\u4e2a action\uff0caction \u7684 payload \u4e3a \u63a5\u53e3\u8fd4\u56de\u7684\u6570\u636e\uff08",(0,r.kt)("inlineCode",{parentName:"p"},"response.data")," \uff09\uff0caction \u7684 \u7c7b\u578b\u4e3a ",(0,r.kt)("inlineCode",{parentName:"p"},"'movie/getMovie/fulfilled'"),"\u3002"),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://i0.hdslb.com/bfs/album/159df9d98522a45641396216dba60a03baec4a71.png",alt:"image-20221031180934282"})),(0,r.kt)("h3",{id:"66-\u4f7f\u7528-extrareducers"},"6.6 \u4f7f\u7528 extraReducers"),(0,r.kt)("p",null,"\u6709\u65f6 slice \u7684 reducer \u9700\u8981\u54cd\u5e94 ",(0,r.kt)("em",{parentName:"p"},"\u6ca1\u6709")," \u5b9a\u4e49\u5230\u8be5 slice \u7684 ",(0,r.kt)("inlineCode",{parentName:"p"},"reducers")," \u5b57\u6bb5\u4e2d\u7684 action\u3002\u8fd9\u4e2a\u65f6\u5019\u5c31\u9700\u8981\u4f7f\u7528 slice \u4e2d\u7684 ",(0,r.kt)("inlineCode",{parentName:"p"},"extraReducers")," \u5b57\u6bb5\u3002"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"extraReducers")," \u9009\u9879\u662f\u4e00\u4e2a\u63a5\u6536\u540d\u4e3a ",(0,r.kt)("inlineCode",{parentName:"p"},"builder")," \u7684\u53c2\u6570\u7684\u51fd\u6570\u3002",(0,r.kt)("inlineCode",{parentName:"p"},"builder")," \u5bf9\u8c61\u63d0\u4f9b\u4e86\u4e00\u4e9b\u65b9\u6cd5\uff0c\u8ba9\u6211\u4eec\u53ef\u4ee5\u5b9a\u4e49\u989d\u5916\u7684 case reducer\uff0c\u8fd9\u4e9b reducer \u5c06\u54cd\u5e94\u5728 slice \u4e4b\u5916\u5b9a\u4e49\u7684 action\u3002\u6211\u4eec\u5c06\u4f7f\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"builder.addCase(actionCreator, reducer)")," \u6765\u5904\u7406\u5f02\u6b65 thunk dispatch \u7684\u6bcf\u4e2a action\u3002"),(0,r.kt)("p",null,"\u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c\u6211\u4eec\u9700\u8981\u76d1\u542c\u6211\u4eec ",(0,r.kt)("inlineCode",{parentName:"p"},"getMovieData"),' thunk dispatch \u7684 "pending" \u548c "fulfilled" action \u7c7b\u578b\u3002\u8fd9\u4e9b action creator \u9644\u52a0\u5230\u6211\u4eec\u5b9e\u9645\u7684 ',(0,r.kt)("inlineCode",{parentName:"p"},"getMovieData")," \u51fd\u6570\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06\u5b83\u4eec\u4f20\u9012\u7ed9 ",(0,r.kt)("inlineCode",{parentName:"p"},"extraReducers")," \u6765\u76d1\u542c\u8fd9\u4e9b action\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"const initialState = {\n  status: 'idel',\n  list: [],\n  totals: 0,\n}\n\nexport const getMovieData = createAsyncThunk('movie/getMovie', async () => {\n  const res = await reqMovieListApi()\n  return res.data\n})\n\n// \u521b\u5efa\u4e00\u4e2a Slice\nexport const movieSlice = createSlice({\n  name: 'movie',\n  initialState,\n  // extraReducers \u5b57\u6bb5\u8ba9 slice \u5904\u7406\u5728\u522b\u5904\u5b9a\u4e49\u7684 actions\uff0c\n  // \u5305\u62ec\u7531 createAsyncThunk \u6216\u5176\u4ed6slice\u751f\u6210\u7684actions\u3002\n  extraReducers(builder) {\n    builder\n      .addCase(getMovieData.pending, state => {\n        console.log('\ud83d\ude80 ~ \u8fdb\u884c\u4e2d\uff01')\n        state.status = 'pending'\n      })\n      .addCase(getMovieData.fulfilled, (state, action) => {\n        console.log('\ud83d\ude80 ~ fulfilled', action.payload)\n        state.status = 'pending'\n        state.list = state.list.concat(action.payload.list)\n        state.totals = action.payload.list.length\n      })\n      .addCase(getMovieData.rejected, (state, action) => {\n        console.log('\ud83d\ude80 ~ rejected', action)\n        state.status = 'pending'\n        state.error = action.error.message\n      })\n  },\n})\n\n// \u9ed8\u8ba4\u5bfc\u51fa\nexport default movieSlice.reducer\n")),(0,r.kt)("p",null,"\u6211\u4eec\u5c06\u6839\u636e\u8fd4\u56de\u7684 ",(0,r.kt)("inlineCode",{parentName:"p"},"Promise")," \u5904\u7406\u53ef\u4ee5\u7531 thunk dispatch \u7684\u4e09\u79cd action \u7c7b\u578b\uff1a"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u5f53\u8bf7\u6c42\u5f00\u59cb\u65f6\uff0c\u6211\u4eec\u5c06 ",(0,r.kt)("inlineCode",{parentName:"li"},"status")," \u679a\u4e3e\u8bbe\u7f6e\u4e3a ",(0,r.kt)("inlineCode",{parentName:"li"},"'pending'")),(0,r.kt)("li",{parentName:"ul"},"\u5982\u679c\u8bf7\u6c42\u6210\u529f\uff0c\u6211\u4eec\u5c06 ",(0,r.kt)("inlineCode",{parentName:"li"},"status")," \u6807\u8bb0\u4e3a ",(0,r.kt)("inlineCode",{parentName:"li"},"'pending'"),"\uff0c\u5e76\u5c06\u83b7\u53d6\u7684\u7535\u5f71\u5217\u8868\u6dfb\u52a0\u5230 ",(0,r.kt)("inlineCode",{parentName:"li"},"state.list")),(0,r.kt)("li",{parentName:"ul"},"\u5982\u679c\u8bf7\u6c42\u5931\u8d25\uff0c\u6211\u4eec\u4f1a\u5c06 ",(0,r.kt)("inlineCode",{parentName:"li"},"status")," \u6807\u8bb0\u4e3a ",(0,r.kt)("inlineCode",{parentName:"li"},"'pending'"),"\uff0c\u5e76\u5c06\u4efb\u4f55\u9519\u8bef\u6d88\u606f\u4fdd\u5b58\u5230\u72b6\u6001\u4e2d\u4ee5\u4fbf\u6211\u4eec\u53ef\u4ee5\u663e\u793a\u5b83")),(0,r.kt)("h3",{id:"67-\u5b8c\u5584\u6848\u4f8b"},"6.7 \u5b8c\u5584\u6848\u4f8b"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"store/index.js")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"import { configureStore } from '@reduxjs/toolkit'\nimport counterSlice from './features/counterSlice'\nimport movieSlice from './features/movieSlice'\n\n// configureStore\u521b\u5efa\u4e00\u4e2aredux\u6570\u636e\nconst store = configureStore({\n  // \u5408\u5e76\u591a\u4e2aSlice\n  reducer: {\n    counter: counterSlice,\n    movie: movieSlice,\n  },\n})\n\nexport default store\n")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"Movie.jsx")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-jsx"},"// \u5f15\u5165\u76f8\u5173\u7684hooks\nimport { useSelector, useDispatch } from 'react-redux'\n// \u5f15\u5165\u5bf9\u5e94\u7684\u65b9\u6cd5\nimport { getMovieData } from '../store/features/movieSlice'\nfunction Movie() {\n  // \u901a\u8fc7useSelector\u76f4\u63a5\u62ff\u5230store\u4e2d\u5b9a\u4e49\u7684list\n  const movieList = useSelector(store => store.movie.list)\n  // \u901a\u8fc7useDispatch \u6d3e\u53d1\u4e8b\u4ef6\n  const dispatch = useDispatch()\n\n  return (\n    <div>\n      <button\n        onClick={() => {\n          dispatch(getMovieData())\n        }}\n      >\n        \u83b7\u53d6\u6570\u636e\n      </button>\n      <ul>\n        {movieList.map(movie => {\n          return <li key={movie.tvId}> {movie.name}</li>\n        })}\n      </ul>\n    </div>\n  )\n}\n\nexport default Movie\n")),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://i0.hdslb.com/bfs/album/84d47a7b89855f8182268804f9dfdfcf232fc632.png",alt:"image-20221031182248330"})),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"createAsyncThunk "),"\u53ef\u4ee5\u5199\u5728\u4efb\u4f55\u4e00\u4e2aslice\u7684",(0,r.kt)("inlineCode",{parentName:"p"},"extraReducers"),"\u4e2d\uff0c\u5b83\u63a5\u65362\u4e2a\u53c2\u6570\uff0c"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u751f\u6210",(0,r.kt)("inlineCode",{parentName:"li"},"action"),"\u7684",(0,r.kt)("inlineCode",{parentName:"li"},"type"),"\u503c\uff0c\u8fd9\u91cctype\u662f\u8981\u81ea\u5df1\u5b9a\u4e49\uff0c\u4e0d\u50cf\u662f",(0,r.kt)("inlineCode",{parentName:"li"},"createSlice"),"\u81ea\u52a8\u751f\u6210",(0,r.kt)("inlineCode",{parentName:"li"},"type"),"\uff0c\u8fd9\u5c31\u8981\u6ce8\u610f\u907f\u514d\u547d\u540d\u51b2\u7a81\u95ee\u9898\u4e86(\u5982\u679c",(0,r.kt)("inlineCode",{parentName:"li"},"createSlice"),"\u5b9a\u4e49\u4e86\u76f8\u5f53\u7684",(0,r.kt)("inlineCode",{parentName:"li"},"name"),"\u548c\u65b9\u6cd5\uff0c\u4e5f\u662f\u4f1a\u51b2\u7a81\u7684)"),(0,r.kt)("li",{parentName:"ul"},"\u5305\u542b\u6570\u636e\u5904\u7406\u7684",(0,r.kt)("inlineCode",{parentName:"li"},"promise"),"\uff0c\u9996\u5148\u4f1a",(0,r.kt)("inlineCode",{parentName:"li"},"dispatch"),"\u4e00\u4e2a",(0,r.kt)("inlineCode",{parentName:"li"},"action"),"\u7c7b\u578b\u4e3a",(0,r.kt)("inlineCode",{parentName:"li"},"movie/getMovie/pending"),"\uff0c\u5f53\u5f02\u6b65\u8bf7\u6c42\u5b8c\u6210\u540e\uff0c\u6839\u636e\u7ed3\u679c\u6210\u529f\u6216\u662f\u5931\u8d25\uff0c\u51b3\u5b9adispatch\u51faaction\u7684\u7c7b\u578b\u4e3a",(0,r.kt)("inlineCode",{parentName:"li"},"movie/getMovie/fulfilled"),"\u6216",(0,r.kt)("inlineCode",{parentName:"li"},"movie/getMovie/rejected"),"\uff0c\u8fd9\u4e09\u4e2a",(0,r.kt)("inlineCode",{parentName:"li"},"action"),"\u53ef\u4ee5\u5728",(0,r.kt)("inlineCode",{parentName:"li"},"slice"),"\u7684",(0,r.kt)("inlineCode",{parentName:"li"},"extraReducers"),"\u4e2d\u8fdb\u884c\u5904\u7406\u3002\u8fd9\u4e2a",(0,r.kt)("inlineCode",{parentName:"li"},"promise"),"\u4e5f\u53ea\u63a5\u65362\u4e2a\u53c2\u6570\uff0c\u5206\u522b\u662f",(0,r.kt)("inlineCode",{parentName:"li"},"payload"),"\u548c\u5305\u542b\u4e86",(0,r.kt)("inlineCode",{parentName:"li"},"dispatch"),"\u3001",(0,r.kt)("inlineCode",{parentName:"li"},"getState"),"\u7684",(0,r.kt)("inlineCode",{parentName:"li"},"thunkAPI"),"\u5bf9\u8c61\uff0c\u6240\u4ee5\u9664\u4e86\u5728",(0,r.kt)("inlineCode",{parentName:"li"},"slice"),"\u7684",(0,r.kt)("inlineCode",{parentName:"li"},"extraReducers"),"\u4e2d\u5904\u7406\u4e4b\u5916\uff0c",(0,r.kt)("inlineCode",{parentName:"li"},"createAsyncThunk"),"\u4e2d\u4e5f\u53ef\u4ee5\u8c03\u7528\u4efb\u610f\u7684action\uff0c\u8fd9\u6837\u5c31\u5f88\u50cf\u539f\u672cthunk\u7684\u5199\u6cd5\u4e86\uff0c\u5e76\u4e0d\u63a8\u8350")),(0,r.kt)("h2",{id:"7\u6570\u636e\u6301\u4e45\u5316"},"7.\u6570\u636e\u6301\u4e45\u5316"),(0,r.kt)("h3",{id:"71-\u6982\u5ff5"},"7.1 \u6982\u5ff5"),(0,r.kt)("p",null,"\u4e00\u822c\u662f\u6307\u9875\u9762\u5237\u65b0\u540e\uff0c\u6570\u636e\u4ecd\u7136\u80fd\u591f\u4fdd\u6301\u539f\u6765\u7684\u72b6\u6001\u3002"),(0,r.kt)("p",null,"\u4e00\u822c\u5728\u524d\u7aef\u5f53\u4e2d\uff0c\u6570\u636e\u6301\u4e45\u5316\uff0c\u53ef\u4ee5\u901a\u8fc7\u5c06\u6570\u636e\u5b58\u50a8\u5230localstorage\u6216Cookie\u4e2d\u5b58\u8d77\u6765\uff0c\u7528\u5230\u7684\u65f6"),(0,r.kt)("p",null,"\u5019\u76f4\u63a5\u4ece\u672c\u5730\u5b58\u50a8\u4e2d\u83b7\u53d6\u6570\u636e\u3002\u800credux-persist\u662f\u628aredux\u4e2d\u7684\u6570\u636e\u5728localstorage\u4e2d\u5b58\u8d77\u6765\uff0c\u8d77\u5230\u6301\u4e45\u5316\u7684\u6548\u679c\u3002"),(0,r.kt)("h3",{id:"72-\u4f7f\u7528"},"7.2 \u4f7f\u7528"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"npm i redux-persist --save\n")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"store/index.js")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"import { configureStore, combineReducers } from '@reduxjs/toolkit'\n// --- \u65b0\u589e ---\nimport {\n  persistStore,\n  persistReducer,\n  FLUSH,\n  REHYDRATE,\n  PAUSE,\n  PERSIST,\n  PURGE,\n  REGISTER,\n} from 'redux-persist'\nimport storage from 'redux-persist/lib/storage'\n// --- \u65b0\u589e ---\nimport counterSlice from './features/counterSlice'\nimport movieSlice from './features/movieSlice'\n\n// --- \u65b0\u589e ---\nconst persistConfig = {\n  key: 'root',\n  storage,\n  // \u6307\u5b9a\u54ea\u4e9breducer\u6570\u636e\u6301\u4e45\u5316\n  whitelist: ['movie'],\n}\n\nconst persistedReducer = persistReducer(\n  persistConfig,\n  combineReducers({\n    counter: counterSlice,\n    movie: movieSlice,\n  }),\n)\n// --- \u65b0\u589e ---\n\n// \u8fd9\u91cc\u7167\u7740\u6211\u8fd9\u6837\u914d\u4e2d\u95f4\u4ef6\u5c31\u884c\uff0cgetDefaultMiddleware\u4e0d\u8981\u76f4\u63a5\u5bfc\u5165\u4e86\uff0c\u5df2\u7ecf\u5185\u7f6e\u4e86\nexport const store = configureStore({\n  reducer: persistedReducer,\n  middleware: getDefaultMiddleware =>\n    getDefaultMiddleware({\n      serializableCheck: {\n        ignoredActions: [FLUSH, REHYDRATE, PAUSE, PERSIST, PURGE, REGISTER],\n      },\n    }),\n})\n\nexport const persistor = persistStore(store)\n")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"main.js")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-jsx"},"import React from 'react'\nimport ReactDOM from 'react-dom/client'\nimport App from './App'\nimport Movie from './components/Movie'\nimport { Provider } from 'react-redux'\n\nimport { PersistGate } from 'redux-persist/integration/react'\nimport { store, persistor } from './store'\n\nReactDOM.createRoot(document.getElementById('root')).render(\n  <Provider store={store}>\n    <PersistGate loading={null} persistor={persistor}>\n      <Movie />\n    </PersistGate>\n  </Provider>,\n)\n")),(0,r.kt)("p",null,"\u7136\u540e\u5c31\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\u4e86\u3002"),(0,r.kt)("p",null,"\u6700\u7ec8\u6548\u679c\uff1a"),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://i0.hdslb.com/bfs/album/97d4bbd5610cc930365efd8ecfb63a83174a9ce4.png",alt:"image-20221105211826950"})),(0,r.kt)("h3",{id:"73-\u8ba9\u6bcf\u4e00\u4e2a\u4ed3\u5e93\u5355\u72ec\u5b58\u50a8"},"7.3 \u8ba9\u6bcf\u4e00\u4e2a\u4ed3\u5e93\u5355\u72ec\u5b58\u50a8"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"\u4ee5\u524d\u4f7f\u7528\u8fc7",(0,r.kt)("inlineCode",{parentName:"p"},"pinia-plugin-persist"),"\uff0c\u6211\u89c9\u5f97\u8fd9\u4e2a",(0,r.kt)("inlineCode",{parentName:"p"},"pinia"),"\u8fd9\u4e2a\u63d2\u4ef6\u4f7f\u7528\u6bd4",(0,r.kt)("inlineCode",{parentName:"p"},"redux-persist"),"\u65b9\u4fbf"),(0,r.kt)("p",{parentName:"blockquote"},"\u8fd9\u91cc\u7684\u65b9\u6cd5\u662f\u6211\u81ea\u5df1\u60f3\u51fa\u6765\u7684\uff0c\u4e0d\u77e5\u9053\u5bf9\u4e0d\u5bf9")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"store/index.js")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"import { configureStore, combineReducers } from '@reduxjs/toolkit'\nimport {\n  persistStore,\n  persistReducer,\n  FLUSH,\n  REHYDRATE,\n  PAUSE,\n  PERSIST,\n  PURGE,\n  REGISTER,\n} from 'redux-persist'\nimport storage from 'redux-persist/lib/storage'\nimport counterSlice from './features/counterSlice'\nimport movieSlice from './features/movieSlice'\n\nconst rootPersistConfig = {\n  key: 'root',\n  storage,\n  whitelist: [],\n}\n\nconst moviePersistConfig = {\n  key: 'movie',\n  storage,\n}\n\nconst counterPersistConfig = {\n  key: 'counter',\n  storage,\n}\n\nconst persistedReducer = persistReducer(\n  rootPersistConfig,\n  combineReducers({\n    counter: persistReducer(counterPersistConfig, counterSlice),\n    movie: persistReducer(moviePersistConfig, movieSlice),\n  }),\n)\n\n// configureStore\u521b\u5efa\u4e00\u4e2aredux\u6570\u636e\nexport const store = configureStore({\n  // \u5408\u5e76\u591a\u4e2aSlice\n  reducer: persistedReducer,\n  middleware: getDefaultMiddleware =>\n    getDefaultMiddleware({\n      serializableCheck: {\n        ignoredActions: [FLUSH, REHYDRATE, PAUSE, PERSIST, PURGE, REGISTER],\n      },\n    }),\n})\nexport const persistor = persistStore(store)\n")),(0,r.kt)("p",null,"\u6548\u679c\uff1a"),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://i0.hdslb.com/bfs/album/4825fcc8afd830b4099bd1e772c76e4266c529d1.png",alt:"image-20221105212117068"})))}s.isMDXComponent=!0}}]);