"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[4436],{3905:(e,n,r)=>{r.d(n,{Zo:()=>p,kt:()=>d});var t=r(7294);function o(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function s(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),r.push.apply(r,t)}return r}function l(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?s(Object(r),!0).forEach((function(n){o(e,n,r[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):s(Object(r)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))}))}return e}function a(e,n){if(null==e)return{};var r,t,o=function(e,n){if(null==e)return{};var r,t,o={},s=Object.keys(e);for(t=0;t<s.length;t++)r=s[t],n.indexOf(r)>=0||(o[r]=e[r]);return o}(e,n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(t=0;t<s.length;t++)r=s[t],n.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}var i=t.createContext({}),c=function(e){var n=t.useContext(i),r=n;return e&&(r="function"==typeof e?e(n):l(l({},n),e)),r},p=function(e){var n=c(e.components);return t.createElement(i.Provider,{value:n},e.children)},m="mdxType",u={inlineCode:"code",wrapper:function(e){var n=e.children;return t.createElement(t.Fragment,{},n)}},v=t.forwardRef((function(e,n){var r=e.components,o=e.mdxType,s=e.originalType,i=e.parentName,p=a(e,["components","mdxType","originalType","parentName"]),m=c(r),v=o,d=m["".concat(i,".").concat(v)]||m[v]||u[v]||s;return r?t.createElement(d,l(l({ref:n},p),{},{components:r})):t.createElement(d,l({ref:n},p))}));function d(e,n){var r=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var s=r.length,l=new Array(s);l[0]=v;var a={};for(var i in n)hasOwnProperty.call(n,i)&&(a[i]=n[i]);a.originalType=e,a[m]="string"==typeof e?e:o,l[1]=a;for(var c=2;c<s;c++)l[c]=r[c];return t.createElement.apply(null,l)}return t.createElement.apply(null,r)}v.displayName="MDXCreateElement"},439:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>i,contentTitle:()=>l,default:()=>m,frontMatter:()=>s,metadata:()=>a,toc:()=>c});var t=r(7462),o=(r(7294),r(3905));const s={},l="Promise",a={unversionedId:"ES6/Promise",id:"ES6/Promise",title:"Promise",description:"Promise\u662fES6\u5f15\u5165\u7684\u5f02\u6b65\u7f16\u7a0b\u7684\u65b0\u89e3\u51b3\u65b9\u6848\u3002\u8bed\u6cd5\u4e0aPromise\u662f\u4e00\u4e2a\u6784\u9020\u51fd\u6570\uff0c\u7528\u6765\u5c01\u88c5\u5f02\u6b65\u64cd\u4f5c\u5e76\u53ef\u4ee5\u83b7\u53d6\u5176\u6210\u529f\u6216\u5931\u8d25\u7684\u7ed3\u679c\u3002",source:"@site/docs/ES6/03.Promise.md",sourceDirName:"ES6",slug:"/ES6/Promise",permalink:"/docs/ES6/Promise",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/ES6/03.Promise.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"es6 \u65b0\u7279\u6027",permalink:"/docs/ES6/ES6\u65b0\u7279\u6027"},next:{title:"Set",permalink:"/docs/ES6/Set"}},i={},c=[{value:"1.1. Promise \u662f\u4ec0\u4e48?",id:"11-promise-\u662f\u4ec0\u4e48",level:2},{value:"1.1.1. \u7406\u89e3",id:"111-\u7406\u89e3",level:3},{value:"1.1.2. promise \u7684\u72b6\u6001\u6539\u53d8",id:"112-promise-\u7684\u72b6\u6001\u6539\u53d8",level:3},{value:"1. Promise \u7684\u72b6\u6001",id:"1-promise-\u7684\u72b6\u6001",level:4},{value:"2. Promise \u5bf9\u8c61\u7684\u503c",id:"2-promise-\u5bf9\u8c61\u7684\u503c",level:4},{value:"1.1.3. promise \u7684\u57fa\u672c\u6d41\u7a0b",id:"113-promise-\u7684\u57fa\u672c\u6d41\u7a0b",level:3},{value:"\u5c0f\u6848\u4f8b",id:"\u5c0f\u6848\u4f8b",level:3},{value:"util.promisify \u65b9\u6cd5",id:"utilpromisify-\u65b9\u6cd5",level:4},{value:"1.2. \u4e3a\u4ec0\u4e48\u8981\u7528 Promise?",id:"12-\u4e3a\u4ec0\u4e48\u8981\u7528-promise",level:2},{value:"1.2.1. \u6307\u5b9a\u56de\u8c03\u51fd\u6570\u7684\u65b9\u5f0f\u66f4\u52a0\u7075\u6d3b",id:"121-\u6307\u5b9a\u56de\u8c03\u51fd\u6570\u7684\u65b9\u5f0f\u66f4\u52a0\u7075\u6d3b",level:4},{value:"1.2.2. \u652f\u6301\u94fe\u5f0f\u8c03\u7528, \u53ef\u4ee5\u89e3\u51b3\u56de\u8c03\u5730\u72f1\u95ee\u9898",id:"122-\u652f\u6301\u94fe\u5f0f\u8c03\u7528-\u53ef\u4ee5\u89e3\u51b3\u56de\u8c03\u5730\u72f1\u95ee\u9898",level:4},{value:"1.3. \u5982\u4f55\u4f7f\u7528 Promise?",id:"13-\u5982\u4f55\u4f7f\u7528-promise",level:2},{value:"1.3.1. API",id:"131-api",level:3},{value:"1. Promise \u6784\u9020\u51fd\u6570: Promise (excutor) {}",id:"1-promise-\u6784\u9020\u51fd\u6570-promise-excutor-",level:4},{value:"2. Promise.prototype.then \u65b9\u6cd5: (onResolved, onRejected) =&gt; {}",id:"2-promiseprototypethen-\u65b9\u6cd5-onresolved-onrejected--",level:4},{value:"3. Promise.prototype.catch \u65b9\u6cd5: (onRejected) =&gt; {}",id:"3-promiseprototypecatch-\u65b9\u6cd5-onrejected--",level:4},{value:"4.  Promise.resolve \u65b9\u6cd5: (value) =&gt; {}  \u9759\u6001\u65b9\u6cd5",id:"4--promiseresolve-\u65b9\u6cd5-value----\u9759\u6001\u65b9\u6cd5",level:4},{value:"5. Promise.reject \u65b9\u6cd5: (reason) =&gt; {}",id:"5-promisereject-\u65b9\u6cd5-reason--",level:4},{value:"6. Promise.all \u65b9\u6cd5: (promises) =&gt; {}",id:"6-promiseall-\u65b9\u6cd5-promises--",level:4},{value:"7. Promise.race \u65b9\u6cd5: (promises) =&gt; {}",id:"7-promiserace-\u65b9\u6cd5-promises--",level:4},{value:"1.3.2. promise \u7684\u51e0\u4e2a\u5173\u952e\u95ee\u9898",id:"132-promise-\u7684\u51e0\u4e2a\u5173\u952e\u95ee\u9898",level:3},{value:"1.  \u5982\u4f55\u6539\u53d8 promise \u7684\u72b6\u6001?",id:"1--\u5982\u4f55\u6539\u53d8-promise-\u7684\u72b6\u6001",level:4},{value:"2. \u4e00\u4e2a promise \u6307\u5b9a\u591a\u4e2a\u6210\u529f/\u5931\u8d25\u56de\u8c03\u51fd\u6570\uff08then\uff09, \u90fd\u4f1a\u8c03\u7528\u5417?",id:"2-\u4e00\u4e2a-promise-\u6307\u5b9a\u591a\u4e2a\u6210\u529f\u5931\u8d25\u56de\u8c03\u51fd\u6570then-\u90fd\u4f1a\u8c03\u7528\u5417",level:4},{value:"3. \u6539\u53d8 promise \u72b6\u6001\u548c\u6307\u5b9a\u56de\u8c03\u51fd\u6570\u8c01\u5148\u8c01\u540e?",id:"3-\u6539\u53d8-promise-\u72b6\u6001\u548c\u6307\u5b9a\u56de\u8c03\u51fd\u6570\u8c01\u5148\u8c01\u540e",level:4},{value:"4. promise.then()\u8fd4\u56de\u7684\u65b0 promise \u7684\u7ed3\u679c\u72b6\u6001\u7531\u4ec0\u4e48\u51b3\u5b9a",id:"4-promisethen\u8fd4\u56de\u7684\u65b0-promise-\u7684\u7ed3\u679c\u72b6\u6001\u7531\u4ec0\u4e48\u51b3\u5b9a",level:4},{value:"5. promise \u5982\u4f55\u4e32\u8fde\u591a\u4e2a\u64cd\u4f5c\u4efb\u52a1?",id:"5-promise-\u5982\u4f55\u4e32\u8fde\u591a\u4e2a\u64cd\u4f5c\u4efb\u52a1",level:4},{value:"6. promise \u5f02\u5e38\u4f20\u900f?",id:"6-promise-\u5f02\u5e38\u4f20\u900f",level:4},{value:"7. \u4e2d\u65ad promise \u94fe?",id:"7-\u4e2d\u65ad-promise-\u94fe",level:4},{value:"2.1. \u5b9a\u4e49\u6574\u4f53\u7ed3\u6784",id:"21-\u5b9a\u4e49\u6574\u4f53\u7ed3\u6784",level:3},{value:"2.2. Promise \u6784\u9020\u51fd\u6570\u7684\u5b9e\u73b0",id:"22-promise-\u6784\u9020\u51fd\u6570\u7684\u5b9e\u73b0",level:3},{value:"2.3. promise.then()/catch()\u7684\u5b9e\u73b0",id:"23-promisethencatch\u7684\u5b9e\u73b0",level:3},{value:"2.4. Promise.resolve()/reject()\u7684\u5b9e\u73b0",id:"24-promiseresolvereject\u7684\u5b9e\u73b0",level:3},{value:"2.5. Promise.all/race()\u7684\u5b9e\u73b0",id:"25-promiseallrace\u7684\u5b9e\u73b0",level:3},{value:"2.6. Promise.resolveDelay()/rejectDelay()\u7684\u5b9e\u73b0",id:"26-promiseresolvedelayrejectdelay\u7684\u5b9e\u73b0",level:3},{value:"\u81ea\u5b9a\u4e49\u5c01\u88c5\u5168",id:"\u81ea\u5b9a\u4e49\u5c01\u88c5\u5168",level:3},{value:"class\u7248\u672c\u5c01\u88c5",id:"class\u7248\u672c\u5c01\u88c5",level:3},{value:"3.1. mdn \u6587\u6863",id:"31-mdn-\u6587\u6863",level:3},{value:"3.2. async \u51fd\u6570",id:"32-async-\u51fd\u6570",level:3},{value:"3.3. await \u8868\u8fbe\u5f0f",id:"33-await-\u8868\u8fbe\u5f0f",level:3},{value:"3.4. \u6ce8\u610f",id:"34-\u6ce8\u610f",level:3}],p={toc:c};function m(e){let{components:n,...r}=e;return(0,o.kt)("wrapper",(0,t.Z)({},p,r,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"promise"},"Promise"),(0,o.kt)("p",null,"Promise\u662fES6\u5f15\u5165\u7684\u5f02\u6b65\u7f16\u7a0b\u7684\u65b0\u89e3\u51b3\u65b9\u6848\u3002\u8bed\u6cd5\u4e0aPromise\u662f\u4e00\u4e2a\u6784\u9020\u51fd\u6570\uff0c\u7528\u6765\u5c01\u88c5\u5f02\u6b65\u64cd\u4f5c\u5e76\u53ef\u4ee5\u83b7\u53d6\u5176\u6210\u529f\u6216\u5931\u8d25\u7684\u7ed3\u679c\u3002"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Promise\u6784\u9020\u51fd\u6570: ",(0,o.kt)("inlineCode",{parentName:"li"},"Promise (excutor) {}")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("inlineCode",{parentName:"li"},"Promise.prototype.then"),"\u65b9\u6cd5"),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("inlineCode",{parentName:"li"},"Promise.prototype.catch"),"\u65b9\u6cd5")),(0,o.kt)("h1",{id:"\u7b2c-1-\u7ae0-promise-\u7684\u7406\u89e3\u548c\u4f7f\u7528"},"\u7b2c 1 \u7ae0\uff1a Promise \u7684\u7406\u89e3\u548c\u4f7f\u7528"),(0,o.kt)("h2",{id:"11-promise-\u662f\u4ec0\u4e48"},"1.1. Promise \u662f\u4ec0\u4e48?"),(0,o.kt)("h3",{id:"111-\u7406\u89e3"},"1.1.1. \u7406\u89e3"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"\u62bd\u8c61\u8868\u8fbe:",(0,o.kt)("ol",{parentName:"li"},(0,o.kt)("li",{parentName:"ol"},"Promise \u662f\u4e00\u95e8\u65b0\u7684\u6280\u672f(ES6 \u89c4\u8303)"),(0,o.kt)("li",{parentName:"ol"},"Promise \u662f JS \u4e2d\u8fdb\u884c\u5f02\u6b65\u7f16\u7a0b\u7684\u65b0\u89e3\u51b3\u65b9\u6848")))),(0,o.kt)("p",null,"\u5907\u6ce8\uff1a\u65e7\u65b9\u6848\u662f\u5355\u7eaf\u4f7f\u7528\u56de\u8c03\u51fd\u6570\n2. \u5177\u4f53\u8868\u8fbe:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"\u4ece\u8bed\u6cd5\u4e0a\u6765\u8bf4: Promise \u662f\u4e00\u4e2a\u6784\u9020\u51fd\u6570"),(0,o.kt)("li",{parentName:"ol"},"\u4ece\u529f\u80fd\u4e0a\u6765\u8bf4: promise \u5bf9\u8c61\u7528\u6765\u5c01\u88c5\u4e00\u4e2a\u5f02\u6b65\u64cd\u4f5c\u5e76\u53ef\u4ee5\u83b7\u53d6\u5176\u6210\u529f/\u5931\u8d25\u7684\u7ed3\u679c\u503c")),(0,o.kt)("h3",{id:"112-promise-\u7684\u72b6\u6001\u6539\u53d8"},"1.1.2. promise \u7684\u72b6\u6001\u6539\u53d8"),(0,o.kt)("h4",{id:"1-promise-\u7684\u72b6\u6001"},"1. Promise \u7684\u72b6\u6001"),(0,o.kt)("p",null,"\u5b9e\u4f8b\u5bf9\u8c61\u4e2d\u7684\u4e00\u4e2a\u5c5e\u6027 \u300ePromiseState\u300f"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"pending \xa0\u672a\u51b3\u5b9a\u7684"),(0,o.kt)("li",{parentName:"ul"},"resolved / fullfilled \xa0\u6210\u529f"),(0,o.kt)("li",{parentName:"ul"},"rejected \xa0\u5931\u8d25",(0,o.kt)("ol",{parentName:"li"},(0,o.kt)("li",{parentName:"ol"},"pending \u53d8\u4e3a resolved"),(0,o.kt)("li",{parentName:"ol"},"pending \u53d8\u4e3a rejected")))),(0,o.kt)("p",null,"\u8bf4\u660e: \u53ea\u6709\u8fd9 2 \u79cd, \u4e14\u4e00\u4e2a promise \u5bf9\u8c61\u53ea\u80fd\u6539\u53d8\u4e00\u6b21\n\u65e0\u8bba\u53d8\u4e3a\u6210\u529f\u8fd8\u662f\u5931\u8d25, \u90fd\u4f1a\u6709\u4e00\u4e2a\u7ed3\u679c\u6570\u636e\n\u6210\u529f\u7684\u7ed3\u679c\u6570\u636e\u4e00\u822c\u79f0\u4e3a value, \u5931\u8d25\u7684\u7ed3\u679c\u6570\u636e\u4e00\u822c\u79f0\u4e3a reason"),(0,o.kt)("h4",{id:"2-promise-\u5bf9\u8c61\u7684\u503c"},"2. Promise \u5bf9\u8c61\u7684\u503c"),(0,o.kt)("p",null,"\u5b9e\u4f8b\u5bf9\u8c61\u4e2d\u7684\u53e6\u4e00\u4e2a\u5c5e\u6027 \u300ePromiseResult\u300f\n\u4fdd\u5b58\u7740\u5f02\u6b65\u4efb\u52a1\u300e\u6210\u529f/\u5931\u8d25\u300f\u7684\u7ed3\u679c"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"resolve"),(0,o.kt)("li",{parentName:"ul"},"reject")),(0,o.kt)("h3",{id:"113-promise-\u7684\u57fa\u672c\u6d41\u7a0b"},"1.1.3. promise \u7684\u57fa\u672c\u6d41\u7a0b"),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://cdn.nlark.com/yuque/0/2022/png/27952305/1660132070084-5d20ca6f-818c-4073-93af-958a24f01e2a.png#averageHue=%23fafaf9&clientId=u43e1b17a-73b3-4&crop=0&crop=0&crop=1&crop=1&from=ui&id=ude979ecc&margin=%5Bobject%20Object%5D&name=1.png&originHeight=509&originWidth=1659&originalType=binary&ratio=1&rotation=0&showTitle=false&size=96073&status=done&style=none&taskId=u1d0fca71-37e6-4b33-a282-cef2458e91a&title=",alt:"1.png"})),(0,o.kt)("h3",{id:"\u5c0f\u6848\u4f8b"},"\u5c0f\u6848\u4f8b"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},'//\u5b9e\u4f8b\u5316Promise \u5bf9\u8c61\nconst p = new Promise(function(resolve,reject){\n    setTimeout(function(){\n        let data = "\u6570\u636e\u5e93\u4e2d\u7684\u7528\u6237\u6570\u636e"\n        //\u6570\u636e\u8bfb\u53d6\u6210\u529f\n        // resolve(data);\n        //\u6570\u636e\u8bfb\u53d6\u5931\u8d25\n        let err = "\u6570\u636e\u8bfb\u53d6\u5931\u8d25"\n        reject(err)\n    },1000)\n})\n//\u8c03\u7528 Promise \u5bf9\u8c61\u7684then\u65b9\u6cd5\np.then(function(value){   //\u8bfb\u53d6\u6210\u529f\u8c03\u7b2c\u4e00\u4e2a\n    console.log(value)\n}),function(reason){      //\u8bfb\u53d6\u5931\u8d25\u8c03\u7b2c\u4e8c\u4e2a\n   console.error(reason)\n}\n')),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},'//\u5f15\u5165 fs \u6a21\u5757\nconst fs = require("fs")\n\n//\u8c03\u7528\u65b9\u6cd5\u8bfb\u53d6\u6587\u4ef6\n// fs.readFile("./hello.txt",(err,data)=>{\n//     //\u5982\u679c\u5931\u8d25\uff0c\u5219\u629b\u51fa\u9519\u8bef\n//     if(err) throw err;\n//     //\u5982\u679c\u6ca1\u6709\u51fa\u9519\uff0c\u5219\u8f93\u51fa\u5185\u5bb9\n//     console.log(data.toString())\n// })\n\n//\u4f7f\u7528Promise\u8bfb\u53d6\u6587\u4ef6  \nconst p =new Promise(function(resolve, reject){\n    fs.readFile("./hello.txt",(err,data)=>{\n        //\u5982\u679c\u5931\u8d25\uff0c\u5219\u629b\u51fa\u9519\u8bef\n        if(err) reject (err);\n        //\u5982\u679c\u6210\u529f\uff0c\u5219\u8f93\u51fa\u5185\u5bb9\n        resolve(data)\n    })\n})\np.then(function(value){\n    console.log(value.toString())\n},function(reason){\n    console.log("\u8bfb\u53d6\u5931\u8d25")\n})\n')),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},'//path \u6587\u4ef6\u8def\u5f84\nfunction mineFile (path){\n    return new Promise((resolve,reject)=>{\n\n        require("fs").readFile(path,(err,data)=>{\n            if(err) reject(err)\n            resolve(data)\n        })\n    })\n}\nmineFile("./hello.tx").then(value=>{\n    //\u8bfb\u53d6\u6210\u529f \u8f93\u51fa\u6587\u4ef6\u5185\u5bb9\n    console.log(value.toString())\n},reason=>{\n    //\u8bfb\u53d6\u5931\u8d25 \u8f93\u51fa\u9519\u8bef\n    console.log(reason)\n})\n')),(0,o.kt)("h4",{id:"utilpromisify-\u65b9\u6cd5"},"util.promisify \u65b9\u6cd5"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},'//util.promisify \u65b9\u6cd5\n// \u5f15\u5165 util \u6a21\u5757\nconst util = require("util")\n// \u5f15\u5165fs \u6a21\u5757\nconst fs = require("fs")\n// \u8fd4\u56de\u4e00\u4e2a\u65b0\u7684\u51fd\u6570\nlet mineReadFile = util.promisify(fs.readFile)\n\nmineReadFile("./hello.txt").then(value=>{\n    console.log(value.toString())\n})\n')),(0,o.kt)("p",null,"\u5c01\u88c5ajax \u8bf7\u6c42"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},'<!DOCTYPE html>\n<html lang="en">\n\n<head>\n    <meta charset="UTF-8">\n    <meta http-equiv="X-UA-Compatible" content="IE=edge">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <title>Document</title>\n</head>\n\n<body>\n    <script>\n        function sendAJAX(url) {\n            return new Promise((resolve, reject) => {\n                const xhr = new XMLHttpRequest()\n                xhr.responseType = "json"\n                xhr.open("GET", url)\n                xhr.send()\n                //\u5904\u7406\u7ed3\u679c\n                xhr.onreadystatechange = function(){\n                    if(xhr.readyState === 4){\n                        if(xhr.status>=200 && xhr.status<300){\n                            resolve(xhr.response)\n                        }else{\n                            reject(xhr.status)\n                        }\n                    }\n                }\n            })\n        }\n\n        sendAJAX("http://127.0.0.1:8000/server").then(value=>{\n                console.log(value.toString())},\n            reason=>{\n                console.log(reason)\n            })\n    <\/script>\n</body>\n\n</html>\n')),(0,o.kt)("h2",{id:"12-\u4e3a\u4ec0\u4e48\u8981\u7528-promise"},"1.2. \u4e3a\u4ec0\u4e48\u8981\u7528 Promise?"),(0,o.kt)("h4",{id:"121-\u6307\u5b9a\u56de\u8c03\u51fd\u6570\u7684\u65b9\u5f0f\u66f4\u52a0\u7075\u6d3b"},"1.2.1. \u6307\u5b9a\u56de\u8c03\u51fd\u6570\u7684\u65b9\u5f0f\u66f4\u52a0\u7075\u6d3b"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"\u65e7\u7684: \u5fc5\u987b\u5728\u542f\u52a8\u5f02\u6b65\u4efb\u52a1\u524d\u6307\u5b9a"),(0,o.kt)("li",{parentName:"ol"},"promise: \u542f\u52a8\u5f02\u6b65\u4efb\u52a1 => \u8fd4\u56de promie\u5bf9\u8c61 => \u7ed9 promise\u5bf9\u8c61\u7ed1\u5b9a\u56de\u8c03\u51fd\n\u6570(\u751a\u81f3\u53ef\u4ee5\u5728\u5f02\u6b65\u4efb\u52a1\u7ed3\u675f\u540e\u6307\u5b9a/\u591a\u4e2a)")),(0,o.kt)("h4",{id:"122-\u652f\u6301\u94fe\u5f0f\u8c03\u7528-\u53ef\u4ee5\u89e3\u51b3\u56de\u8c03\u5730\u72f1\u95ee\u9898"},"1.2.2. \u652f\u6301\u94fe\u5f0f\u8c03\u7528, \u53ef\u4ee5\u89e3\u51b3\u56de\u8c03\u5730\u72f1\u95ee\u9898"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"\u4ec0\u4e48\u662f\u56de\u8c03\u5730\u72f1?")),(0,o.kt)("p",null,"\u56de\u8c03\u51fd\u6570\u5d4c\u5957\u8c03\u7528, \u5916\u90e8\u56de\u8c03\u51fd\u6570\u5f02\u6b65\u6267\u884c\u7684\u7ed3\u679c\u662f\u5d4c\u5957\u7684\u56de\u8c03\u6267\u884c\u7684\u6761\u4ef6\n2. \u56de\u8c03\u5730\u72f1\u7684\u7f3a\u70b9?\n\u4e0d\u4fbf\u4e8e\u9605\u8bfb\n\u4e0d\u4fbf\u4e8e\u5f02\u5e38\u5904\u7406\n3. \u89e3\u51b3\u65b9\u6848?\npromise \u94fe\u5f0f\u8c03\u7528\n4. \u7ec8\u6781\u89e3\u51b3\u65b9\u6848?"),(0,o.kt)("h2",{id:"13-\u5982\u4f55\u4f7f\u7528-promise"},"1.3. \u5982\u4f55\u4f7f\u7528 Promise?"),(0,o.kt)("h3",{id:"131-api"},"1.3.1. API"),(0,o.kt)("h4",{id:"1-promise-\u6784\u9020\u51fd\u6570-promise-excutor-"},"1. Promise \u6784\u9020\u51fd\u6570: Promise (excutor) {}"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"executor \u51fd\u6570: \u6267\u884c\u5668 (resolve, reject) => {}"),(0,o.kt)("li",{parentName:"ol"},"resolve \u51fd\u6570: \u5185\u90e8\u5b9a\u4e49\u6210\u529f\u65f6\u6211\u4eec\u8c03\u7528\u7684\u51fd\u6570 value => {}"),(0,o.kt)("li",{parentName:"ol"},"reject \u51fd\u6570: \u5185\u90e8\u5b9a\u4e49\u5931\u8d25\u65f6\u6211\u4eec\u8c03\u7528\u7684\u51fd\u6570 reason => {}")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"\u8bf4\u660e: executor \u4f1a\u5728 Promise \u5185\u90e8\u7acb\u5373\u540c\u6b65\u8c03\u7528,\u5f02\u6b65\u64cd\u4f5c\u5728\u6267\u884c\u5668\u4e2d\u6267\u884c")),(0,o.kt)("h4",{id:"2-promiseprototypethen-\u65b9\u6cd5-onresolved-onrejected--"},"2. Promise.prototype.then \u65b9\u6cd5: (onResolved, onRejected) => {}"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"onResolved \u51fd\u6570: \u6210\u529f\u7684\u56de\u8c03\u51fd\u6570 (value) => {}"),(0,o.kt)("li",{parentName:"ol"},"onRejected \u51fd\u6570: \u5931\u8d25\u7684\u56de\u8c03\u51fd\u6570 (reason) => {}")),(0,o.kt)("p",null,"\u8bf4\u660e: \u6307\u5b9a\u7528\u4e8e\u5f97\u5230\u6210\u529f value \u7684\u6210\u529f\u56de\u8c03\u548c\u7528\u4e8e\u5f97\u5230\u5931\u8d25 reason \u7684\u5931\u8d25\u56de\u8c03\n\u8fd4\u56de\u4e00\u4e2a\u65b0\u7684 promise \u5bf9\u8c61()"),(0,o.kt)("h4",{id:"3-promiseprototypecatch-\u65b9\u6cd5-onrejected--"},"3. Promise.prototype.catch \u65b9\u6cd5: (onRejected) => {}"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"onRejected \u51fd\u6570: \u5931\u8d25\u7684\u56de\u8c03\u51fd\u6570 (reason) => {} \xa0")),(0,o.kt)("p",null,"\u8bf4\u660e: then()\u7684\u8bed\u6cd5\u7cd6, \u76f8\u5f53\u4e8e: then(undefined, onRejected)"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},'<script>\n  let p = new Promise((resolve,reject)=>{\n    // resolve("ok")\n    reject("no")\n  })\nconsole.log(p)\np.catch(reason =>{\n  console.log(reason)  //no\n})\n<\/script>\n')),(0,o.kt)("h4",{id:"4--promiseresolve-\u65b9\u6cd5-value----\u9759\u6001\u65b9\u6cd5"},"4.  Promise.resolve \u65b9\u6cd5: (value) => {}  \u9759\u6001\u65b9\u6cd5"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"value: \u6210\u529f\u7684\u6570\u636e\u6216 promise \u5bf9\u8c61")),(0,o.kt)("p",null,"\u8bf4\u660e: \u8fd4\u56de\u4e00\u4e2a\u6210\u529f/\u5931\u8d25\u7684 promise \u5bf9\u8c61"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},'//\u4f20\u5165\u53c2\u6570\u4e3a\u975e Proomise \u7c7b\u578b\u7684\u53c2\u6570\uff0c\u5219\u8fd4\u56de\u6210\u529f\u7684Promise\u5bf9\u8c61\nlet p =Promise.resolve( 521)  //\u72b6\u6001\u4e3a\u6210\u529f\n\n//\u4f20\u5165\u53c2\u6570\u4e3aPromise \u7c7b\u578b\u7684\u53c2\u6570\uff0c\u5219\u53c2\u6570\u7684\u7ed3\u679c\u51b3\u5b9a\u4e86resolve \u7684\u7ed3\u679c\nlet p1 = Promise.resolve(new Promise((resolve,reject)=>{\n  // resolve("ok")  //\u72b6\u6001\u4e3a\u6210\u529f\n  reject("no") //\u72b6\u6001\u4e3a\u5931\u8d25\n}))\n//\u5904\u7406\u5931\u8d25\u7684\u56de\u8c03\np1.catch(r=>{\n  console.log(r)\n})\n')),(0,o.kt)("h4",{id:"5-promisereject-\u65b9\u6cd5-reason--"},"5. Promise.reject \u65b9\u6cd5: (reason) => {}"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"reason: \u5931\u8d25\u7684\u539f\u56e0")),(0,o.kt)("p",null,"\u8bf4\u660e: \u8fd4\u56de\u4e00\u4e2a\u5931\u8d25\u7684 promise \u5bf9\u8c61"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},'//\u4f20\u5165\u53c2\u6570\u4e3a\u975e Proomise \u7c7b\u578b\u7684\u53c2\u6570\uff0c\u5219\u8fd4\u56de\u6210\u529f\u7684Promise\u5bf9\u8c61\nlet p =Promise.reject( 521)  //\u72b6\u6001\u4e3a\u5931\u8d25\n\n//\u4f20\u5165\u53c2\u6570\u4e3aPromise \u7c7b\u578b\u7684\u53c2\u6570\uff0c\u5219\u53c2\u6570\u7684\u7ed3\u679c\u51b3\u5b9a\u4e86resolve \u7684\u7ed3\u679c\nlet p1 = Promise.reject(new Promise((resolve,reject)=>{\n  resolve("ok")  //\u72b6\u6001\u4e3a\u5931\u8d25\n  // reject("no") //\u72b6\u6001\u4e3a\u5931\u8d25\n}))\nconsole.log(p1) //\u5931\u8d25\u7684\u7ed3\u679c\u4e3a\u4f20\u5165\u7684\u53c2\u6570\n')),(0,o.kt)("h4",{id:"6-promiseall-\u65b9\u6cd5-promises--"},"6. Promise.all \u65b9\u6cd5: (promises) => {}"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"promises: \u5305\u542b n \u4e2a promise \u7684\u6570\u7ec4")),(0,o.kt)("p",null,"\u8bf4\u660e: \u8fd4\u56de\u4e00\u4e2a\u65b0\u7684 promise, \u53ea\u6709\u6240\u6709\u7684 promise \u90fd\u6210\u529f\u624d\u6210\u529f, \u53ea\u8981\u6709\u4e00\u4e2a\u5931\u8d25\u4e86\u5c31\n\u76f4\u63a5\u5931\u8d25"),(0,o.kt)("h4",{id:"7-promiserace-\u65b9\u6cd5-promises--"},"7. Promise.race \u65b9\u6cd5: (promises) => {}"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"promises: \u5305\u542b n \u4e2a promise \u7684\u6570\u7ec4")),(0,o.kt)("p",null,"\u8bf4\u660e: \u8fd4\u56de\u4e00\u4e2a\u65b0\u7684 promise, \u7b2c\u4e00\u4e2a\u5b8c\u6210\u7684 promise \u7684\u7ed3\u679c\u72b6\u6001\u5c31\u662f\u6700\u7ec8\u7684\u7ed3\u679c\u72b6\u6001"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"new Promise((resolve, reject) => { \n if (Date.now()%2===0) { \n   resolve(1) \n } else { \n   reject(2) \n } \n }).then(value => { \n   console.log('onResolved1()', value) \n }).catch(reason => { \n   console.log('onRejected1()', reason) \n }) \n\n */ \n \n const p1 = Promise . resolve(1) \n const p2 = Promise . resolve(Promise . resolve ( 3)) \n const p3 = Promise . resolve(Promise . reject ( 5)) \n const p4 = Promise . reject (7) \n const p5 = new Promise (( resolve, reject) => { \n setTimeout (() => { \n   if (Date . now()%2===0) { \n     resolve (1) \n   } else { \n     reject (2) \n   } \n  }, 100); \n }) \n const pAll = Promise . all ([ p1, p2, p5 ]) \n pAll . then ( \n   values => {console . log( 'all \u6210\u529f\u4e86 ' , values )}, \n   reason => {console . log( 'all \u5931\u8d25\u4e86 ' , reason )} \n ) \n \n // const pRace = Promise.race([p5, p4, p1]) \n const pRace = Promise . race([ p5, p1, p4]) \n pRace . then ( \n   value => {console . log( 'race \u6210\u529f\u4e86 ' , value)}, \n   reason => {console . log( 'race \u5931\u8d25\u4e86 ' , reason )} \n ) \n\n<\/script>\n")),(0,o.kt)("h3",{id:"132-promise-\u7684\u51e0\u4e2a\u5173\u952e\u95ee\u9898"},"1.3.2. promise \u7684\u51e0\u4e2a\u5173\u952e\u95ee\u9898"),(0,o.kt)("h4",{id:"1--\u5982\u4f55\u6539\u53d8-promise-\u7684\u72b6\u6001"},"1.  \u5982\u4f55\u6539\u53d8 promise \u7684\u72b6\u6001?"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("inlineCode",{parentName:"li"},"resolve(value)"),": \u5982\u679c\u5f53\u524d\u662f pending \u5c31\u4f1a\u53d8\u4e3a resolved"),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("inlineCode",{parentName:"li"},"reject(reason)"),": \u5982\u679c\u5f53\u524d\u662f pending \u5c31\u4f1a\u53d8\u4e3a rejected"),(0,o.kt)("li",{parentName:"ol"},"\u629b\u51fa\u5f02\u5e38 ",(0,o.kt)("inlineCode",{parentName:"li"},"throw"),": \u5982\u679c\u5f53\u524d\u662f pending \u5c31\u4f1a\u53d8\u4e3a rejected")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"let p = new Promise((resolve, reject) => {\n  //1. resolve \u51fd\u6570\n  // resolve('ok'); // pending   => fulfilled (resolved)\n  //2. reject \u51fd\u6570\n  // reject(\"error\");// pending  =>  rejected \n  //3. \u629b\u51fa\u9519\u8bef\n  // throw '\u51fa\u95ee\u9898\u4e86';\n});\nconsole.log(p);\n")),(0,o.kt)("h4",{id:"2-\u4e00\u4e2a-promise-\u6307\u5b9a\u591a\u4e2a\u6210\u529f\u5931\u8d25\u56de\u8c03\u51fd\u6570then-\u90fd\u4f1a\u8c03\u7528\u5417"},"2. \u4e00\u4e2a promise \u6307\u5b9a\u591a\u4e2a\u6210\u529f/\u5931\u8d25\u56de\u8c03\u51fd\u6570\uff08then\uff09, \u90fd\u4f1a\u8c03\u7528\u5417?"),(0,o.kt)("p",null,"\u5f53 promise \u6539\u53d8\u4e3a\u5bf9\u5e94\u72b6\u6001\u65f6\u90fd\u4f1a\u8c03\u7528"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"let p = new Promise((resolve, reject) => {\n  // resolve('OK');  //\u6539\u53d8\u72b6\u6001\u540e\u8c03\u7528\n});\n\n///\u6307\u5b9a\u56de\u8c03 - 1\np.then(value => {\n  console.log(value);\n});\n\n//\u6307\u5b9a\u56de\u8c03 - 2\np.then(value => {\n  alert(value);\n});\n")),(0,o.kt)("h4",{id:"3-\u6539\u53d8-promise-\u72b6\u6001\u548c\u6307\u5b9a\u56de\u8c03\u51fd\u6570\u8c01\u5148\u8c01\u540e"},"3. \u6539\u53d8 promise \u72b6\u6001\u548c\u6307\u5b9a\u56de\u8c03\u51fd\u6570\u8c01\u5148\u8c01\u540e?"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"\u90fd\u6709\u53ef\u80fd, \u6b63\u5e38\u60c5\u51b5\u4e0b\u662f\u5148\u6307\u5b9a\u56de\u8c03\u518d\u6539\u53d8\u72b6\u6001, \u4f46\u4e5f\u53ef\u4ee5\u5148\u6539\u72b6\u6001\u518d\u6307\u5b9a\u56de\u8c03"),(0,o.kt)("li",{parentName:"ol"},"\u5982\u4f55\u5148\u6539\u72b6\u6001\u518d\u6307\u5b9a\u56de\u8c03?")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"\u5728\u6267\u884c\u5668\u4e2d\u76f4\u63a5\u8c03\u7528 resolve()/reject()"),(0,o.kt)("li",{parentName:"ul"},"\u5ef6\u8fdf\u66f4\u957f\u65f6\u95f4\u624d\u8c03\u7528 then()")),(0,o.kt)("ol",{start:3},(0,o.kt)("li",{parentName:"ol"},"\u4ec0\u4e48\u65f6\u5019\u624d\u80fd\u5f97\u5230\u6570\u636e?")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"\u5982\u679c\u5148\u6307\u5b9a\u7684\u56de\u8c03, \u90a3\u5f53\u72b6\u6001\u53d1\u751f\u6539\u53d8\u65f6, \u56de\u8c03\u51fd\u6570\u5c31\u4f1a\u8c03\u7528, \u5f97\u5230\u6570\u636e"),(0,o.kt)("li",{parentName:"ul"},"\u5982\u679c\u5148\u6539\u53d8\u7684\u72b6\u6001, \u90a3\u5f53\u6307\u5b9a\u56de\u8c03\u65f6, \u56de\u8c03\u51fd\u6570\u5c31\u4f1a\u8c03\u7528, \u5f97\u5230\u6570\u636e")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"let p = new Promise((resolve, reject) => {\n  setTimeout(() => {\n    resolve('OK');\n  }, 1000);\n});\n\np.then(value => {\n  console.log(value);\n},reason=>{\n\n})\n")),(0,o.kt)("h4",{id:"4-promisethen\u8fd4\u56de\u7684\u65b0-promise-\u7684\u7ed3\u679c\u72b6\u6001\u7531\u4ec0\u4e48\u51b3\u5b9a"},"4. promise.then()\u8fd4\u56de\u7684\u65b0 promise \u7684\u7ed3\u679c\u72b6\u6001\u7531\u4ec0\u4e48\u51b3\u5b9a"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"\u7b80\u5355\u8868\u8fbe: \u7531 then()\u6307\u5b9a\u7684\u56de\u8c03\u51fd\u6570\u6267\u884c\u7684\u7ed3\u679c\u51b3\u5b9a"),(0,o.kt)("li",{parentName:"ol"},"\u8be6\u7ec6\u8868\u8fbe:")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"\u5982\u679c\u629b\u51fa\u5f02\u5e38, \u65b0 promise \u53d8\u4e3a rejected, reason \u4e3a\u629b\u51fa\u7684\u5f02\u5e38"),(0,o.kt)("li",{parentName:"ul"},"\u5982\u679c\u8fd4\u56de\u7684\u662f\u975e promise \u7684\u4efb\u610f\u503c, \u65b0 promise \u53d8\u4e3a resolved, value \u4e3a\u8fd4\u56de\u7684\u503c"),(0,o.kt)("li",{parentName:"ul"},"\u5982\u679c\u8fd4\u56de\u7684\u662f\u53e6\u4e00\u4e2a\u65b0 promise, \u6b64 promise \u7684\u7ed3\u679c\u5c31\u4f1a\u6210\u4e3a\u65b0 promise \u7684\u7ed3\u679c")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"let p = new Promise((resolve, reject) => {\n  resolve('ok');\n});\n//\u6267\u884c then \u65b9\u6cd5\nlet result = p.then(value => {\n  // console.log(value);\n  //1. \u629b\u51fa\u9519\u8bef\n  // throw '\u51fa\u4e86\u95ee\u9898';\n  //2. \u8fd4\u56de\u7ed3\u679c\u662f\u975e Promise \u7c7b\u578b\u7684\u5bf9\u8c61\n  // return 521;\n  //3. \u8fd4\u56de\u7ed3\u679c\u662f Promise \u5bf9\u8c61\n  // return new Promise((resolve, reject) => {\n  //     // resolve('success');\n  //     reject('error');\n  // });\n}, reason => {\n  console.warn(reason);\n});\n\nconsole.log(result);\n")),(0,o.kt)("h4",{id:"5-promise-\u5982\u4f55\u4e32\u8fde\u591a\u4e2a\u64cd\u4f5c\u4efb\u52a1"},"5. promise \u5982\u4f55\u4e32\u8fde\u591a\u4e2a\u64cd\u4f5c\u4efb\u52a1?"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"promise \u7684 then()\u8fd4\u56de\u4e00\u4e2a\u65b0\u7684 promise, \u53ef\u4ee5\u5f00\u6210 then()\u7684\u94fe\u5f0f\u8c03\u7528"),(0,o.kt)("li",{parentName:"ol"},"\u901a\u8fc7 then \u7684\u94fe\u5f0f\u8c03\u7528\u4e32\u8fde\u591a\u4e2a\u540c\u6b65/\u5f02\u6b65\u4efb\u52a1")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"let p = new Promise((resolve, reject) => {\n  setTimeout(() => {\n    resolve('OK');\n  }, 1000);\n});\n\np.then(value => {\n  return new Promise((resolve, reject) => {\n    resolve(\"success\");\n  });\n}).then(value => {\n  console.log(value);  //success\n}).then(value => {\n  console.log(value);  //undefined\n})\n")),(0,o.kt)("h4",{id:"6-promise-\u5f02\u5e38\u4f20\u900f"},"6. promise \u5f02\u5e38\u4f20\u900f?"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"\u5f53\u4f7f\u7528 promise \u7684 then \u94fe\u5f0f\u8c03\u7528\u65f6, \u53ef\u4ee5\u5728\u6700\u540e\u6307\u5b9a\u5931\u8d25\u7684\u56de\u8c03,"),(0,o.kt)("li",{parentName:"ol"},"\u524d\u9762\u4efb\u4f55\u64cd\u4f5c\u51fa\u4e86\u5f02\u5e38, \u90fd\u4f1a\u4f20\u5230\u6700\u540e\u5931\u8d25\u7684\u56de\u8c03\u4e2d\u5904\u7406")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"let p = new Promise((resolve, reject) => {\n  setTimeout(() => {\n    resolve('OK');  \n    // reject('Err');  \n  }, 1000);\n});\n\np.then(value => {\n  // console.log(111);\n  throw '\u5931\u8d25\u5566!';\n}).then(value => {\n  console.log(222);\n}).then(value => {\n  console.log(333);\n}).catch(reason => {\n  console.warn(reason); // \u5931\u8d25\u5566\n});\n")),(0,o.kt)("h4",{id:"7-\u4e2d\u65ad-promise-\u94fe"},"7. \u4e2d\u65ad promise \u94fe?"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"\u5f53\u4f7f\u7528 promise \u7684 then \u94fe\u5f0f\u8c03\u7528\u65f6, \u5728\u4e2d\u95f4\u4e2d\u65ad, \u4e0d\u518d\u8c03\u7528\u540e\u9762\u7684\u56de\u8c03\u51fd\u6570"),(0,o.kt)("li",{parentName:"ol"},"\u529e\u6cd5: \u5728\u56de\u8c03\u51fd\u6570\u4e2d\u8fd4\u56de\u4e00\u4e2a pendding \u72b6\u6001\u7684 promise \u5bf9\u8c61")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"let p = new Promise((resolve, reject) => {\n  setTimeout(() => {\n    resolve('OK');\n  }, 1000);\n});\n\np.then(value => {\n  console.log(111);\n  //\u6709\u4e14\u53ea\u6709\u4e00\u4e2a\u65b9\u5f0f\n  return new Promise(() => {});  //\u72b6\u6001\u4e3apendding \u540e\u9762\u7684\u56de\u8c03\u51fd\u6570\u90fd\u4e0d\u80fd\u6267\u884c\n}).then(value => {\n  console.log(222);\n}).then(value => {\n  console.log(333);\n}).catch(reason => {\n  console.warn(reason);\n});\n")),(0,o.kt)("h1",{id:"\u7b2c-2-\u7ae0\u81ea\u5b9a\u4e49\u624b\u5199promise"},"\u7b2c 2 \u7ae0\uff1a\u81ea\u5b9a\u4e49(\u624b\u5199)Promise"),(0,o.kt)("h3",{id:"21-\u5b9a\u4e49\u6574\u4f53\u7ed3\u6784"},"2.1. \u5b9a\u4e49\u6574\u4f53\u7ed3\u6784"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"//\u81ea\u5b9a\u4e49 Promise\n(function (window) {\n\n //Promise \u6784\u9020\u51fd\u6570\n //excutor: \u5185\u90e8\u540c\u6b65\u6267\u884c\u7684\u51fd\u6570 (resolve, reject) => {}\n functionPromise(excutor) {\n } \n//\u4e3a promise \u6307\u5b9a\u6210\u529f/\u5931\u8d25\u7684\u56de\u8c03\u51fd\u6570\n//\u51fd\u6570\u7684\u8fd4\u56de\u503c\u662f\u4e00\u4e2a\u65b0\u7684 promise \u5bf9\u8c61\n Promise.prototype.then = function (onResolved, onRejected) {\n } \n\n//\u4e3a promise \u6307\u5b9a\u5931\u8d25\u7684\u56de\u8c03\u51fd\u6570\n//\u662f then(null, onRejected)\u7684\u8bed\u6cd5\u7cd6\n Promise.prototype.catch = function (onRejected) {\n } \n  \n//\u8fd4\u56de\u4e00\u4e2a\u6307\u5b9a\u4e86\u6210\u529f value \u7684 promise \u5bf9\u8c61\n Promise.resolve = function (value) {\n }\n  \n//\u8fd4\u56de\u4e00\u4e2a\u6307\u5b9a\u4e86\u5931\u8d25 reason \u7684 promise \u5bf9\u8c61\n Promise.reject = function (reason) {\n }\n  \n//\u8fd4\u56de\u4e00\u4e2a promise, \u53ea\u6709 promises \u4e2d\u6240\u6709 promise \u90fd\u6210\u529f\u65f6, \u624d\u6700\u7ec8\u6210\u529f, \u53ea\u8981\u6709\u4e00\u4e2a\u5931\u8d25\u5c31\u76f4\u63a5 \u5931\u8d25\n Promise.all = function (promises) {\n } \n  \n//\u8fd4\u56de\u4e00\u4e2a promise\uff0c\u4e00\u65e6\u67d0\u4e2a promise \u89e3\u51b3\u6216\u62d2\u7edd\uff0c\u8fd4\u56de\u7684 promise \u5c31\u4f1a\u89e3\u51b3\u6216\u62d2\u7edd\u3002\nPromise.race = function (promises) { } \n\n//\u66b4\u9732\u6784\u9020\u51fd\u6570\nwindow.Promise = Promise })(window) \n")),(0,o.kt)("h3",{id:"22-promise-\u6784\u9020\u51fd\u6570\u7684\u5b9e\u73b0"},"2.2. Promise \u6784\u9020\u51fd\u6570\u7684\u5b9e\u73b0"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"//Promise \u6784\u9020\u51fd\u6570 \n//excutor: \u5185\u90e8\u540c\u6b65\u6267\u884c\u7684\u51fd\u6570 (resolve, reject) => {} \n\nfunction Promise(excutor) {\n\n    const self = this\n\n    self.status = 'pending' // \u72b6\u6001\u503c, \u521d\u59cb\u72b6\u6001\u4e3a pending, \u6210\u529f\u4e86\u53d8\u4e3aresolved, \u5931\u8d25\u4e86\u53d8\u4e3a rejected\n    self.data = undefined // \u7528\u6765\u4fdd\u5b58\u6210\u529f value \u6216\u5931\u8d25 reason \u7684\u5c5e\u6027 \n    self.callbacks = [] // \u7528\u6765\u4fdd\u5b58\u6240\u6709\u5f85\u8c03\u7528\u7684\u5305\u542b onResolved \u548c onRejected \u56de\u8c03\u51fd\u6570\u7684\u5bf9\u8c61\u7684\u6570\u7ec4 \n\n    \n    //\u5f02\u6b65\u5904\u7406\u6210\u529f\u540e\u5e94\u8be5\u8c03\u7528\u7684\u51fd\u6570 \n    //value: \u5c06\u4ea4\u7ed9 onResolve()\u7684\u6210\u529f\u6570\u636e \n   \n    function resolve(value) {\n\n        if (self.status !== 'pending') { // \u5982\u679c\u5f53\u524d\u4e0d\u662f pending, \u76f4\u63a5\u7ed3\u675f \n            return\n        }\n\n        // \u7acb\u5373\u66f4\u65b0\u72b6\u6001, \u4fdd\u5b58\u6570\u636e \n        self.status = 'resolved'\n        self.data = value\n\n        // \u5f02\u6b65\u8c03\u7528\u6240\u6709\u5f85\u5904\u7406\u7684 onResolved \u6210\u529f\u56de\u8c03\u51fd\u6570 \n        if (self.callbacks.length > 0) {\n            setTimeout(() => {\n                self.callbacks.forEach(obj => {\n                    obj.onResolved(value)\n                })\n            })\n        }\n    }\n\n    //\u5f02\u6b65\u5904\u7406\u5931\u8d25\u540e\u5e94\u8be5\u8c03\u7528\u7684\u51fd\u6570 \n   \n    //reason: \u5c06\u4ea4\u7ed9 onRejected()\u7684\u5931\u8d25\u6570\u636e \n   \n    function reject(reason) {\n        if (self.status !== 'pending') { // \u5982\u679c\u5f53\u524d\u4e0d\u662f pending, \u76f4\u63a5\u7ed3\u675f \n            return\n        }\n\n        // \u7acb\u5373\u66f4\u65b0\u72b6\u6001, \u4fdd\u5b58\u6570\u636e \n        self.status = 'rejected'\n        self.data = reason\n\n        // \u5f02\u6b65\u8c03\u7528\u6240\u6709\u5f85\u5904\u7406\u7684 onRejected \u56de\u8c03\u51fd\u6570 \n        setTimeout(() => {\n            self.callbacks.forEach(obj => {\n                obj.onRejected(reason)\n            })\n        })\n    }\n    try {\n        // \u7acb\u5373\u540c\u6b65\u8c03\u7528 excutor()\u5904\u7406 \n        excutor(resolve, reject)\n    } catch (error) { // \u5982\u679c\u51fa\u4e86\u5f02\u5e38, \u76f4\u63a5\u5931\u8d25 \n        reject(error)\n    }\n}\n")),(0,o.kt)("h3",{id:"23-promisethencatch\u7684\u5b9e\u73b0"},"2.3. promise.then()/catch()\u7684\u5b9e\u73b0"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"//\u4e3a promise \u6307\u5b9a\u6210\u529f/\u5931\u8d25\u7684\u56de\u8c03\u51fd\u6570 \n\n//\u51fd\u6570\u7684\u8fd4\u56de\u503c\u662f\u4e00\u4e2a\u65b0\u7684 promise \u5bf9\u8c61 \nPromise.prototype.then = function (onResolved, onRejected) {\n    const self = this\n\n    // \u5982\u679c onResolved/onRejected \u4e0d\u662f\u51fd\u6570, \u53ef\u5b83\u6307\u5b9a\u4e00\u4e2a\u9ed8\u8ba4\u7684\u51fd\u6570 \n    onResolved = typeof onResolved === 'function' ? onResolved : value => value \n    // \u6307\u5b9a\u8fd4\u56de\u7684 promise \u4e3a\u4e00\u4e2a\u6210\u529f\u72b6\u6001, \u7ed3\u679c\u503c\u4e3a value \n    onRejected = typeof onRejected === 'function' ? onRejected : reason => { throw reason } \n    // \u6307\u5b9a\u8fd4\u56de\u7684 promise \u4e3a\u4e00\u4e2a\u5931\u8d25\u72b6\u6001, \u7ed3\u679c\u503c\u4e3a reason \n\n    // \u8fd4\u56de\u4e00\u4e2a\u65b0\u7684 promise \u5bf9\u8c61 \n    return new Promise((resolve, reject) => {\n\n        //\u4e13\u95e8\u62bd\u53d6\u7684\u7528\u6765\u5904\u7406 promise \u6210\u529f/\u5931\u8d25\u7ed3\u679c\u7684\u51fd\u6570 \n       \n        //callback: \u6210\u529f/\u5931\u8d25\u7684\u56de\u8c03\u51fd\u6570  \n        function handle(callback) {\n            // 1. \u629b\u51fa\u5f02\u5e38 ===> \u8fd4\u56de\u7684 promise \u53d8\u4e3a rejected \n            try {\n                const x = callback(self.data)\n                // 2. \u8fd4\u56de\u4e00\u4e2a\u65b0\u7684 promise ===> \u5f97\u5230\u65b0\u7684 promise \u7684\u7ed3\u679c\u503c\u4f5c\u4e3a\u8fd4\u56de\u7684promise \u7684\u7ed3\u679c\u503c \n                if (x instanceof Promise) {\n                    x.then(resolve, reject) // \u4e00\u65e6 x \u6210\u529f\u4e86, resolve(value), \u4e00\u65e6 x\u5931\u8d25\u4e86: reject(reason)\n                } else {\n                    // 3. \u8fd4\u56de\u4e00\u4e2a\u4e00\u822c\u503c(undefined) ===> \u5c06\u8fd9\u4e2a\u503c\u4f5c\u4e3a\u8fd4\u56de\u7684 promise \u7684\u6210\u529f\u503c\n                    resolve(x)\n                }\n            } catch (error) {\n                reject(error)\n            }\n        }\n\n        if (self.status === 'resolved') { // \u5f53\u524d promise \u5df2\u7ecf\u6210\u529f\u4e86 \n            setTimeout(() => {\n                handle(onResolved)\n            })\n        } else if (self.status === 'rejected') { // \u5f53\u524d promise \u5df2\u7ecf\u5931\u8d25\u4e86 \n            setTimeout(() => {\n                handle(onRejected)\n            })\n        } else { // \u5f53\u524d promise \u8fd8\u672a\u786e\u5b9a pending \n            // \u5c06 onResolved \u548c onRejected \u4fdd\u5b58\u8d77\u6765 \n            self.callbacks.push({\n                onResolved(value) {\n                    handle(onResolved)\n                },\n                onRejected(reason) {\n                    handle(onRejected)\n                }\n            })\n        }\n    })\n}\n\n//\u4e3a promise \u6307\u5b9a\u5931\u8d25\u7684\u56de\u8c03\u51fd\u6570 \n//\u662f then(null, onRejected)\u7684\u8bed\u6cd5\u7cd6 \n\nPromise.prototype.catch = function (onRejected) {\n    return this.then(null, onRejected)\n}\n")),(0,o.kt)("h3",{id:"24-promiseresolvereject\u7684\u5b9e\u73b0"},"2.4. Promise.resolve()/reject()\u7684\u5b9e\u73b0"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"//\u8fd4\u56de\u4e00\u4e2a\u6307\u5b9a\u4e86\u6210\u529f value \u7684 promise \u5bf9\u8c61 \n//value: \u4e00\u822c\u6570\u636e\u6216 promise \n\nPromise.resolve = function (value) {\n    return new Promise((resolve, reject) => {\n        if (value instanceof Promise) {\n            value.then(resolve, reject)\n        } else {\n            resolve(value)\n        }\n    })\n}\n\n//\u8fd4\u56de\u4e00\u4e2a\u6307\u5b9a\u4e86\u5931\u8d25 reason \u7684 promise \u5bf9\u8c61 \n//reason: \u4e00\u822c\u6570\u636e/error \nPromise.reject = function (reason) {\n    return new Promise((resolve, reject) => {\n        reject(reason)\n    })\n} \n")),(0,o.kt)("h3",{id:"25-promiseallrace\u7684\u5b9e\u73b0"},"2.5. Promise.all/race()\u7684\u5b9e\u73b0"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"//\u8fd4\u56de\u4e00\u4e2a\u65b0\u7684 promise \u5bf9\u8c61, \u53ea\u6709 promises \u4e2d\u6240\u6709 promise \u90fd\u4ea7\u751f\u6210\u529f value \u65f6, \u624d\n//\u6700\u7ec8\u6210\u529f, \u53ea\u8981\u6709\u4e00\u4e2a\u5931\u8d25\u5c31\u76f4\u63a5\u5931\u8d25 \n\nPromise.all = function (promises) {\n    // \u8fd4\u56de\u4e00\u4e2a\u65b0\u7684 promise \n    return new Promise((resolve, reject) => {\n        // \u5df2\u6210\u529f\u7684\u6570\u91cf \n        let resolvedCount = 0\n        // \u5f85\u5904\u7406\u7684 promises \u6570\u7ec4\u7684\u957f\u5ea6 \n        const promisesLength = promises.length\n        // \u51c6\u5907\u4e00\u4e2a\u4fdd\u5b58\u6210\u529f\u503c\u7684\u6570\u7ec4 \n        const values = new Array(promisesLength)\n        // \u904d\u5386\u6bcf\u4e2a\u5f85\u5904\u7406\u7684 promise \n        for (let i = 0; i < promisesLength; i++) {\n            // promises \u4e2d\u5143\u7d20\u53ef\u80fd\u4e0d\u662f\u4e00\u4e2a\u6570\u7ec4, \u9700\u8981\u7528 resolve \u5305\u88c5\u4e00\u4e0b \n            Promise.resolve(promises[i]).then(\n                value => {\n                    // \u6210\u529f\u5f53\u524d promise \u6210\u529f\u7684\u503c\u5230\u5bf9\u5e94\u7684\u4e0b\u6807 \n                    values[i] = value\n                    // \u6210\u529f\u7684\u6570\u91cf\u52a0 1 \n                    resolvedCount++\n                    // \u4e00\u65e6\u5168\u90e8\u6210\u529f \n                    if (resolvedCount === promisesLength) {\n                        // \u5c06\u6240\u6709\u6210\u529f\u503c\u7684\u6570\u7ec4\u4f5c\u4e3a\u8fd4\u56de promise \u5bf9\u8c61\u7684\u6210\u529f\u7ed3\u679c\u503c \n                        resolve(values)\n                    }\n                },\n                reason => {\n                    // \u4e00\u65e6\u6709\u4e00\u4e2apromise\u4ea7\u751f\u4e86\u5931\u8d25\u7ed3\u679c\u503c, \u5c06\u5176\u4f5c\u4e3a\u8fd4\u56depromise\u5bf9\u8c61\u7684\u5931\u8d25\u7ed3\u679c\u503c\n                    reject(reason)\n                }\n            )\n        }\n    })\n}\n\n\n//\u8fd4\u56de\u4e00\u4e2a promise\uff0c\u4e00\u65e6\u67d0\u4e2a promise \u89e3\u51b3\u6216\u62d2\u7edd\uff0c \u8fd4\u56de\u7684 promise \u5c31\u4f1a\u89e3\u51b3\u6216\u62d2\u7edd\u3002 \n\nPromise.race = function (promises) {\n    // \u8fd4\u56de\u65b0\u7684 promise \u5bf9\u8c61 \n    return new Promise((resolve, reject) => {\n        // \u904d\u5386\u6240\u6709 promise \n        for (var i = 0; i < promises.length; i++) {\n            Promise.resolve(promises[i]).then(\n                (value) => { // \u53ea\u8981\u6709\u4e00\u4e2a\u6210\u529f\u4e86, \u8fd4\u56de\u7684 promise \u5c31\u6210\u529f\u4e86 \n                    resolve(value)\n                },\n                (reason) => { // \u53ea\u8981\u6709\u4e00\u4e2a\u5931\u8d25\u4e86, \u8fd4\u56de\u7684\u7ed3\u679c\u5c31\u5931\u8d25\u4e86 \n                    reject(reason)\n                }\n            )\n        }\n    })\n}\n")),(0,o.kt)("h3",{id:"26-promiseresolvedelayrejectdelay\u7684\u5b9e\u73b0"},"2.6. Promise.resolveDelay()/rejectDelay()\u7684\u5b9e\u73b0"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"// \u8fd4\u56de\u4e00\u4e2a\u5ef6\u8fdf\u6307\u5b9a\u65f6\u95f4\u624d\u786e\u5b9a\u7ed3\u679c\u7684 promise \u5bf9\u8c61\n\nPromise.resolveDelay = function (value, time) {\n    return new Promise((resolve, reject) => {\n        setTimeout(() => {\n            if (value instanceof Promise) { // \u5982\u679c value \u662f\u4e00\u4e2a promise, \u53d6\u8fd9\u4e2apromise \u7684\u7ed3\u679c\u503c\u4f5c\u4e3a\u8fd4\u56de\u7684 promise \u7684\u7ed3\u679c\u503c \n                value.then(resolve, reject) // \u5982\u679c value \u6210\u529f, \u8c03\u7528resolve(val), \u5982\u679c value \u5931\u8d25\u4e86, \u8c03\u7528 reject(reason) \n            } else {\n                resolve(value)\n            }\n        }, time);\n    })\n}\n \n//\u8fd4\u56de\u4e00\u4e2a\u5ef6\u8fdf\u6307\u5b9a\u65f6\u95f4\u624d\u5931\u8d25\u7684 Promise \u5bf9\u8c61\u3002 \n \nPromise.rejectDelay = function (reason, time) {\n    return new Promise((resolve, reject) => {\n        setTimeout(() => {\n            reject(reason)\n        }, time)\n    })\n}\n")),(0,o.kt)("h3",{id:"\u81ea\u5b9a\u4e49\u5c01\u88c5\u5168"},"\u81ea\u5b9a\u4e49\u5c01\u88c5\u5168"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"//\u58f0\u660e\u6784\u9020\u51fd\u6570\nfunction Promise(executor){\n    //\u6dfb\u52a0\u5c5e\u6027\n    this.PromiseState = 'pending';\n    this.PromiseResult = null;\n    //\u58f0\u660e\u5c5e\u6027\n    this.callbacks = [];\n    //\u4fdd\u5b58\u5b9e\u4f8b\u5bf9\u8c61\u7684 this \u7684\u503c\n    const self = this;// self _this that\n    //resolve \u51fd\u6570\n    function resolve(data){\n        //\u5224\u65ad\u72b6\u6001\n        if(self.PromiseState !== 'pending') return;\n        //1. \u4fee\u6539\u5bf9\u8c61\u7684\u72b6\u6001 (promiseState)\n        self.PromiseState = 'fulfilled';// resolved\n        //2. \u8bbe\u7f6e\u5bf9\u8c61\u7ed3\u679c\u503c (promiseResult)\n        self.PromiseResult = data;\n        //\u8c03\u7528\u6210\u529f\u7684\u56de\u8c03\u51fd\u6570\n        setTimeout(() => {\n            self.callbacks.forEach(item => {\n                item.onResolved(data);\n            });\n        });\n    }\n    //reject \u51fd\u6570\n    function reject(data){\n        //\u5224\u65ad\u72b6\u6001\n        if(self.PromiseState !== 'pending') return;\n        //1. \u4fee\u6539\u5bf9\u8c61\u7684\u72b6\u6001 (promiseState)\n        self.PromiseState = 'rejected';// \n        //2. \u8bbe\u7f6e\u5bf9\u8c61\u7ed3\u679c\u503c (promiseResult)\n        self.PromiseResult = data;\n        //\u6267\u884c\u5931\u8d25\u7684\u56de\u8c03\n        setTimeout(() => {\n            self.callbacks.forEach(item => {\n                item.onRejected(data);\n            });\n        });\n    }\n    try{\n        //\u540c\u6b65\u8c03\u7528\u300e\u6267\u884c\u5668\u51fd\u6570\u300f\n        executor(resolve, reject);\n    }catch(e){\n        //\u4fee\u6539 promise \u5bf9\u8c61\u72b6\u6001\u4e3a\u300e\u5931\u8d25\u300f\n        reject(e);\n    }\n}\n\n//\u6dfb\u52a0 then \u65b9\u6cd5\nPromise.prototype.then = function(onResolved, onRejected){\n    const self = this;\n    //\u5224\u65ad\u56de\u8c03\u51fd\u6570\u53c2\u6570\n    if(typeof onRejected !== 'function'){\n        onRejected = reason => {\n            throw reason;\n        }\n    }\n    if(typeof onResolved !== 'function'){\n        onResolved = value => value;\n        //value => { return value};\n    }\n    return new Promise((resolve, reject) => {\n        //\u5c01\u88c5\u51fd\u6570\n        function callback(type){\n            try{\n                //\u83b7\u53d6\u56de\u8c03\u51fd\u6570\u7684\u6267\u884c\u7ed3\u679c\n                let result = type(self.PromiseResult);\n                //\u5224\u65ad\n                if(result instanceof Promise){\n                    //\u5982\u679c\u662f Promise \u7c7b\u578b\u7684\u5bf9\u8c61\n                    result.then(v => {\n                        resolve(v);\n                    }, r=>{\n                        reject(r);\n                    })\n                }else{\n                    //\u7ed3\u679c\u7684\u5bf9\u8c61\u72b6\u6001\u4e3a\u300e\u6210\u529f\u300f\n                    resolve(result);\n                }\n            }catch(e){\n                reject(e);\n            }\n        }\n        //\u8c03\u7528\u56de\u8c03\u51fd\u6570  PromiseState\n        if(this.PromiseState === 'fulfilled'){\n            setTimeout(() => {\n                callback(onResolved);\n            });\n        }\n        if(this.PromiseState === 'rejected'){\n            setTimeout(() => {\n                callback(onRejected);\n            });\n        }\n        //\u5224\u65ad pending \u72b6\u6001\n        if(this.PromiseState === 'pending'){\n            //\u4fdd\u5b58\u56de\u8c03\u51fd\u6570\n            this.callbacks.push({\n                onResolved: function(){\n                    callback(onResolved);\n                },\n                onRejected: function(){\n                    callback(onRejected);\n                }\n            });\n        }\n    })\n}\n\n//\u6dfb\u52a0 catch \u65b9\u6cd5\nPromise.prototype.catch = function(onRejected){\n    return this.then(undefined, onRejected);\n}\n\n//\u6dfb\u52a0 resolve \u65b9\u6cd5\nPromise.resolve = function(value){\n    //\u8fd4\u56depromise\u5bf9\u8c61\n    return new Promise((resolve, reject) => {\n        if(value instanceof Promise){\n            value.then(v=>{\n                resolve(v);\n            }, r=>{\n                reject(r);\n            })\n        }else{\n            //\u72b6\u6001\u8bbe\u7f6e\u4e3a\u6210\u529f\n            resolve(value);\n        }\n    });\n}\n\n//\u6dfb\u52a0 reject \u65b9\u6cd5\nPromise.reject = function(reason){\n    return new Promise((resolve, reject)=>{\n        reject(reason);\n    });\n}\n\n//\u6dfb\u52a0 all \u65b9\u6cd5\nPromise.all = function(promises){\n    //\u8fd4\u56de\u7ed3\u679c\u4e3apromise\u5bf9\u8c61\n    return new Promise((resolve, reject) => {\n        //\u58f0\u660e\u53d8\u91cf\n        let count = 0;\n        let arr = [];\n        //\u904d\u5386\n        for(let i=0;i<promises.length;i++){\n            //\n            promises[i].then(v => {\n                //\u5f97\u77e5\u5bf9\u8c61\u7684\u72b6\u6001\u662f\u6210\u529f\n                //\u6bcf\u4e2apromise\u5bf9\u8c61 \u90fd\u6210\u529f\n                count++;\n                //\u5c06\u5f53\u524dpromise\u5bf9\u8c61\u6210\u529f\u7684\u7ed3\u679c \u5b58\u5165\u5230\u6570\u7ec4\u4e2d\n                arr[i] = v;\n                //\u5224\u65ad\n                if(count === promises.length){\n                    //\u4fee\u6539\u72b6\u6001\n                    resolve(arr);\n                }\n            }, r => {\n                reject(r);\n            });\n        }\n    });\n}\n\n//\u6dfb\u52a0 race \u65b9\u6cd5\nPromise.race = function(promises){\n    return new Promise((resolve, reject) => {\n        for(let i=0;i<promises.length;i++){\n            promises[i].then(v => {\n                //\u4fee\u6539\u8fd4\u56de\u5bf9\u8c61\u7684\u72b6\u6001\u4e3a \u300e\u6210\u529f\u300f\n                resolve(v);\n            },r=>{\n                //\u4fee\u6539\u8fd4\u56de\u5bf9\u8c61\u7684\u72b6\u6001\u4e3a \u300e\u5931\u8d25\u300f\n                reject(r);\n            })\n        }\n    });\n}\n")),(0,o.kt)("h3",{id:"class\u7248\u672c\u5c01\u88c5"},"class\u7248\u672c\u5c01\u88c5"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"class Promise{\n    //\u6784\u9020\u65b9\u6cd5\n    constructor(executor){\n        //\u6dfb\u52a0\u5c5e\u6027\n        this.PromiseState = 'pending';\n        this.PromiseResult = null;\n        //\u58f0\u660e\u5c5e\u6027\n        this.callbacks = [];\n        //\u4fdd\u5b58\u5b9e\u4f8b\u5bf9\u8c61\u7684 this \u7684\u503c\n        const self = this;// self _this that\n        //resolve \u51fd\u6570\n        function resolve(data){\n            //\u5224\u65ad\u72b6\u6001\n            if(self.PromiseState !== 'pending') return;\n            //1. \u4fee\u6539\u5bf9\u8c61\u7684\u72b6\u6001 (promiseState)\n            self.PromiseState = 'fulfilled';// resolved\n            //2. \u8bbe\u7f6e\u5bf9\u8c61\u7ed3\u679c\u503c (promiseResult)\n            self.PromiseResult = data;\n            //\u8c03\u7528\u6210\u529f\u7684\u56de\u8c03\u51fd\u6570\n            setTimeout(() => {\n                self.callbacks.forEach(item => {\n                    item.onResolved(data);\n                });\n            });\n        }\n        //reject \u51fd\u6570\n        function reject(data){\n            //\u5224\u65ad\u72b6\u6001\n            if(self.PromiseState !== 'pending') return;\n            //1. \u4fee\u6539\u5bf9\u8c61\u7684\u72b6\u6001 (promiseState)\n            self.PromiseState = 'rejected';// \n            //2. \u8bbe\u7f6e\u5bf9\u8c61\u7ed3\u679c\u503c (promiseResult)\n            self.PromiseResult = data;\n            //\u6267\u884c\u5931\u8d25\u7684\u56de\u8c03\n            setTimeout(() => {\n                self.callbacks.forEach(item => {\n                    item.onRejected(data);\n                });\n            });\n        }\n        try{\n            //\u540c\u6b65\u8c03\u7528\u300e\u6267\u884c\u5668\u51fd\u6570\u300f\n            executor(resolve, reject);\n        }catch(e){\n            //\u4fee\u6539 promise \u5bf9\u8c61\u72b6\u6001\u4e3a\u300e\u5931\u8d25\u300f\n            reject(e);\n        }\n    }\n\n    //then \u65b9\u6cd5\u5c01\u88c5\n    then(onResolved,onRejected){\n        const self = this;\n        //\u5224\u65ad\u56de\u8c03\u51fd\u6570\u53c2\u6570\n        if(typeof onRejected !== 'function'){\n            onRejected = reason => {\n                throw reason;\n            }\n        }\n        if(typeof onResolved !== 'function'){\n            onResolved = value => value;\n            //value => { return value};\n        }\n        return new Promise((resolve, reject) => {\n            //\u5c01\u88c5\u51fd\u6570\n            function callback(type){\n                try{\n                    //\u83b7\u53d6\u56de\u8c03\u51fd\u6570\u7684\u6267\u884c\u7ed3\u679c\n                    let result = type(self.PromiseResult);\n                    //\u5224\u65ad\n                    if(result instanceof Promise){\n                        //\u5982\u679c\u662f Promise \u7c7b\u578b\u7684\u5bf9\u8c61\n                        result.then(v => {\n                            resolve(v);\n                        }, r=>{\n                            reject(r);\n                        })\n                    }else{\n                        //\u7ed3\u679c\u7684\u5bf9\u8c61\u72b6\u6001\u4e3a\u300e\u6210\u529f\u300f\n                        resolve(result);\n                    }\n                }catch(e){\n                    reject(e);\n                }\n            }\n            //\u8c03\u7528\u56de\u8c03\u51fd\u6570  PromiseState\n            if(this.PromiseState === 'fulfilled'){\n                setTimeout(() => {\n                    callback(onResolved);\n                });\n            }\n            if(this.PromiseState === 'rejected'){\n                setTimeout(() => {\n                    callback(onRejected);\n                });\n            }\n            //\u5224\u65ad pending \u72b6\u6001\n            if(this.PromiseState === 'pending'){\n                //\u4fdd\u5b58\u56de\u8c03\u51fd\u6570\n                this.callbacks.push({\n                    onResolved: function(){\n                        callback(onResolved);\n                    },\n                    onRejected: function(){\n                        callback(onRejected);\n                    }\n                });\n            }\n        })\n    }\n\n    //catch \u65b9\u6cd5\n    catch(onRejected){\n        return this.then(undefined, onRejected);\n    }\n\n    //\u6dfb\u52a0 resolve \u65b9\u6cd5\n    static resolve(value){\n        //\u8fd4\u56depromise\u5bf9\u8c61\n        return new Promise((resolve, reject) => {\n            if(value instanceof Promise){\n                value.then(v=>{\n                    resolve(v);\n                }, r=>{\n                    reject(r);\n                })\n            }else{\n                //\u72b6\u6001\u8bbe\u7f6e\u4e3a\u6210\u529f\n                resolve(value);\n            }\n        });\n    }\n\n    //\u6dfb\u52a0 reject \u65b9\u6cd5\n    static reject(reason){\n        return new Promise((resolve, reject)=>{\n            reject(reason);\n        });\n    }\n\n    //\u6dfb\u52a0 all \u65b9\u6cd5\n    static all(promises){\n        //\u8fd4\u56de\u7ed3\u679c\u4e3apromise\u5bf9\u8c61\n        return new Promise((resolve, reject) => {\n            //\u58f0\u660e\u53d8\u91cf\n            let count = 0;\n            let arr = [];\n            //\u904d\u5386\n            for(let i=0;i<promises.length;i++){\n                //\n                promises[i].then(v => {\n                    //\u5f97\u77e5\u5bf9\u8c61\u7684\u72b6\u6001\u662f\u6210\u529f\n                    //\u6bcf\u4e2apromise\u5bf9\u8c61 \u90fd\u6210\u529f\n                    count++;\n                    //\u5c06\u5f53\u524dpromise\u5bf9\u8c61\u6210\u529f\u7684\u7ed3\u679c \u5b58\u5165\u5230\u6570\u7ec4\u4e2d\n                    arr[i] = v;\n                    //\u5224\u65ad\n                    if(count === promises.length){\n                        //\u4fee\u6539\u72b6\u6001\n                        resolve(arr);\n                    }\n                }, r => {\n                    reject(r);\n                });\n            }\n        });\n    }\n\n    //\u6dfb\u52a0 race \u65b9\u6cd5\n    static race (promises){\n        return new Promise((resolve, reject) => {\n            for(let i=0;i<promises.length;i++){\n                promises[i].then(v => {\n                    //\u4fee\u6539\u8fd4\u56de\u5bf9\u8c61\u7684\u72b6\u6001\u4e3a \u300e\u6210\u529f\u300f\n                    resolve(v);\n                },r=>{\n                    //\u4fee\u6539\u8fd4\u56de\u5bf9\u8c61\u7684\u72b6\u6001\u4e3a \u300e\u5931\u8d25\u300f\n                    reject(r);\n                })\n            }\n        });\n    }\n}   \n")),(0,o.kt)("h1",{id:"\u7b2c-3-\u7ae0async-\u4e0e-await"},"\u7b2c 3 \u7ae0\uff1aasync \u4e0e await"),(0,o.kt)("h3",{id:"31-mdn-\u6587\u6863"},"3.1. mdn \u6587\u6863"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Statements/async_function"},"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Statements/async_function"),"\n",(0,o.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/await"},"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/await"),"\n",(0,o.kt)("img",{parentName:"p",src:"https://cdn.nlark.com/yuque/0/2022/png/27952305/1663651860717-4abbd6be-1190-4841-8b7f-f558764266cc.png#averageHue=%23fcfcfb&clientId=u0408b8e9-590c-4&crop=0&crop=0&crop=1&crop=1&from=ui&id=ud801344b&margin=%5Bobject%20Object%5D&name=1.png&originHeight=473&originWidth=1132&originalType=binary&ratio=1&rotation=0&showTitle=false&size=270262&status=done&style=none&taskId=u3f1fe3ca-64d5-4dad-8e46-23a17997b45&title=",alt:"1.png"})),(0,o.kt)("h3",{id:"32-async-\u51fd\u6570"},"3.2. async \u51fd\u6570"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"\u51fd\u6570\u7684\u8fd4\u56de\u503c\u4e3a promise \u5bf9\u8c61"),(0,o.kt)("li",{parentName:"ul"},"promise \u5bf9\u8c61\u7684\u7ed3\u679c\u7531 async \u51fd\u6570\u6267\u884c\u7684\u8fd4\u56de\u503c\u51b3\u5b9a")),(0,o.kt)("h3",{id:"33-await-\u8868\u8fbe\u5f0f"},"3.3. await \u8868\u8fbe\u5f0f"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"await \u53f3\u4fa7\u7684\u8868\u8fbe\u5f0f\u4e00\u822c\u4e3a promise \u5bf9\u8c61, \u4f46\u4e5f\u53ef\u4ee5\u662f\u5176\u5b83\u7684\u503c"),(0,o.kt)("li",{parentName:"ul"},"\u5982\u679c\u8868\u8fbe\u5f0f\u662f promise \u5bf9\u8c61, await \u8fd4\u56de\u7684\u662f promise \u6210\u529f\u7684\u503c"),(0,o.kt)("li",{parentName:"ul"},"\u5982\u679c\u8868\u8fbe\u5f0f\u662f\u5176\u5b83\u503c, \u76f4\u63a5\u5c06\u6b64\u503c\u4f5c\u4e3a await \u7684\u8fd4\u56de\u503c")),(0,o.kt)("h3",{id:"34-\u6ce8\u610f"},"3.4. \u6ce8\u610f"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"await \u5fc5\u987b\u5199\u5728 async \u51fd\u6570\u4e2d, \u4f46 async \u51fd\u6570\u4e2d\u53ef\u4ee5\u6ca1\u6709 await"),(0,o.kt)("li",{parentName:"ul"},"\u5982\u679c await \u7684 promise \u5931\u8d25\u4e86, \u5c31\u4f1a\u629b\u51fa\u5f02\u5e38, \u9700\u8981\u901a\u8fc7 try...catch \u6355\u83b7\u5904\u7406")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"<script>\n  //then\n  async function main(){\n  //1. \u5982\u679c\u8fd4\u56de\u503c\u662f\u4e00\u4e2a\u975ePromise\u7c7b\u578b\u7684\u6570\u636e\n  // return 521;\n  //2. \u5982\u679c\u8fd4\u56de\u7684\u662f\u4e00\u4e2aPromise\u5bf9\u8c61\n  // return new Promise((resolve, reject) => {\n  //     // resolve('OK');\n  //     reject('Error');\n  // });\n  //3. \u629b\u51fa\u5f02\u5e38\n  throw \"Oh NO\";\n}\n\nlet result = main();\n\nconsole.log(result);\n<\/script>\n\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"<script>\n  async function main(){\n  let p = new Promise((resolve, reject) => {\n    // resolve('OK');\n    reject('Error');\n  })\n  //1. \u53f3\u4fa7\u4e3apromise\u7684\u60c5\u51b5\n  // let res = await p;\n  //2. \u53f3\u4fa7\u4e3a\u5176\u4ed6\u7c7b\u578b\u7684\u6570\u636e\n  // let res2 = await 20;\n  //3. \u5982\u679cpromise\u662f\u5931\u8d25\u7684\u72b6\u6001\n  try{\n    let res3 = await p;\n  }catch(e){\n    console.log(e);\n  }\n}\n\nmain();\n<\/script>\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"<body>\n  <button id=\"btn\">\u70b9\u51fb\u83b7\u53d6\u6bb5\u5b50</button>\n<script>\n    //axios\n    function sendAJAX(url){\n    return new Promise((resolve, reject) => {\n      const xhr = new XMLHttpRequest();\n      xhr.responseType = 'json';\n      xhr.open(\"GET\", url);\n      xhr.send();\n      //\u5904\u7406\u7ed3\u679c\n      xhr.onreadystatechange = function(){\n        if(xhr.readyState === 4){\n          //\u5224\u65ad\u6210\u529f\n          if(xhr.status >= 200 && xhr.status < 300){\n            //\u6210\u529f\u7684\u7ed3\u679c\n            resolve(xhr.response);\n          }else{\n            reject(xhr.status);\n          }\n        }\n      }\n    });\n  }\n\n//\u6bb5\u5b50\u63a5\u53e3\u5730\u5740 https://api.apiopen.top/getJoke\nlet btn = document.querySelector('#btn');\n\nbtn.addEventListener('click',async function(){\n  //\u83b7\u53d6\u6bb5\u5b50\u4fe1\u606f\n  let duanzi = await sendAJAX('https://api.apiopen.top/getJoke');\n  console.log(duanzi);\n});\n<\/script>\n</body>\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"/**\n * resource  1.html  2.html 3.html \u6587\u4ef6\u5185\u5bb9\n */\n\nconst fs = require('fs');\nconst util = require('util');\nconst mineReadFile = util.promisify(fs.readFile);\n\n//\u56de\u8c03\u51fd\u6570\u7684\u65b9\u5f0f\n// fs.readFile('./resource/1.html', (err, data1) => {\n//     if(err) throw err;\n//     fs.readFile('./resource/2.html', (err, data2) => {\n//         if(err) throw err;\n//         fs.readFile('./resource/3.html', (err, data3) => {\n//             if(err) throw err;\n//             console.log(data1 + data2 + data3);\n//         });\n//     });\n// });\n\n//async \u4e0e await\nasync function main(){\n    try{\n        //\u8bfb\u53d6\u7b2c\u4e00\u4e2a\u6587\u4ef6\u7684\u5185\u5bb9\n        let data1 = await mineReadFile('./resource/1x.html');\n        let data2 = await mineReadFile('./resource/2.html');\n        let data3 = await mineReadFile('./resource/3.html');\n        console.log(data1 + data2 + data3);\n    }catch(e){\n        console.log(e.code);\n    }\n}\n\nmain();\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"function fn1() {\nreturn Promise.resolve(1) }\nfunction fn2() {\nreturn 2 }\nfunction fn3() {\nreturn Promise.reject(3)\n// return fn3.test() // \u7a0b\u5e8f\u8fd0\u884c\u4f1a\u629b\u51fa\u5f02\u5e38\n}\nfunction fn4() {\nreturn fn3.test() // \u7a0b\u5e8f\u8fd0\u884c\u4f1a\u629b\u51fa\u5f02\u5e38\n}\n// \u6ca1\u6709\u4f7f\u7528 await \u7684 async \u51fd\u6570\nasync function fn5() {\nreturn 4 }\nasync function fn() {\n// await \u53f3\u4fa7\u662f\u4e00\u4e2a\u6210\u529f\u7684 promise\nconst result = await fn1()\n// await \u53f3\u4fa7\u662f\u4e00\u4e2a\u975e promise \u7684\u6570\u636e\n// const result = await fn2()\n// await \u53f3\u4fa7\u662f\u4e00\u4e2a\u5931\u8d25\u7684 promise\n// const result = await fn3()\n// await \u53f3\u4fa7\u629b\u51fa\u5f02\u5e38\n// const result = await fn4()\nconsole.log('result: ', result)\nreturn result+10\n}\nasync function test() {\ntry {\nconst result2 = await fn()\nconsole.log('result2', result2) } catch (error) {\nconsole.log('error', error) }\nconst result3 = await fn4()\nconsole.log('result4', result3) }\n// test()\n")))}m.isMDXComponent=!0}}]);